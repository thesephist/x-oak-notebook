<!doctype html>
<meta charset="utf-8">
<title>Oak Notebook</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://oaklang.org/css/main.css">
<link rel="stylesheet" href="https://oaklang.org/css/lib.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

<!-- KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css" integrity="sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js" integrity="sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"
	onload="renderMathInElement(document.body);"></script>
<style>
	body.scrubbing {
		cursor: ew-resize !important;
	}
	main article {
		margin-bottom: 5em;
	}
	.oak-notebook-panel {
		padding: 1em;
		margin: 1.5em 0;
		background: var(--secondary-bg);
		border-radius: 6px;
	}
	.oak-notebook-scrubbable {
		text-decoration: underline;
		text-decoration-color: var(--underline-bg);
		text-underline-offset: 1px;
		text-decoration-thickness: 2px;
		transition: text-decoration-color .2s;
		cursor: ew-resize;
	}
	.oak-notebook-scrubbable:hover {
		text-decoration-color: var(--secondary-text);
	}
	.oak-notebook-panel .resetButton {
		font-size: calc(1em - 4px);
		color: var(--secondary-text);
		cursor: pointer;
		border: 0;
		margin: 0;
		margin-left: 4px;
		outline: 0;
		background: transparent;
	}
	.oak-notebook-panel .resetButton:hover {
		text-decoration: underline;
	}
	.oak-notebook-panel label {
		display: block;
		margin: 1em 0;
		width: 100%;
		max-width: 64ch;
	}
	.oak-notebook-panel .labelText {
		margin-bottom: 4px;
		font-size: calc(1em - 2px);
		color: var(--secondary-text);
	}
	.oak-notebook-panel textarea,
	.oak-notebook-panel input[type="text"],
	.oak-notebook-panel input[type="number"],
	.oak-notebook-panel select,
	.oak-notebook-panel .button {
		border: 0;
		margin: 0;
		outline: 0;
		padding: .6em 1em;
		border-radius: 6px;
		font-size: 1em;
		color: var(--primary-text);
		background: var(--hover-bg);
		transition: background .2s;
		box-sizing: border-box;
	}
	.oak-notebook-panel textarea,
	.oak-notebook-panel input[type="text"],
	.oak-notebook-panel input[type="number"] {
		width: 100%;
	}
	.oak-notebook-panel select {
		cursor: pointer;
	}
	.oak-notebook-panel textarea:focus,
	.oak-notebook-panel input:focus,
	.oak-notebook-panel select:focus {
		background: var(--active-bg);
	}
	.oak-notebook-panel textarea {
		resize: vertical;
		min-height: 6em;
	}
	.oak-notebook-panel .button {
		color: var(--primary-bg);
		background: var(--primary-text);
		cursor: pointer;
		transition: background .2s;
	}
	.oak-notebook-panel .button:hover {
		background: var(--secondary-text);
	}
	.oak-notebook-panel .type-checkbox .labelText {
		display: inline;
	}
	.oak-notebook-panel .type-checkbox input {
		width: auto;
		margin-left: 1ch;
		transform: translate(0, 1px);
		cursor: pointer;
	}
	.oak-notebook-panel .table-container {
		max-width: 100%;
		overflow-x: auto;
	}
	.oak-notebook-panel table {
		width: 100%;
		max-width: 64ch;
		border: 1px solid var(--secondary-text);
		border-collapse: collapse;
	}
	.oak-notebook-panel th,
	.oak-notebook-panel td {
		border: 1px solid var(--secondary-text);
		border-collapse: collapse;
		padding: .6em 1em;
	}
	.oak-notebook-panel table td:not(:first-child) {
		text-align: right;
	}
	.katex-display {
		overflow-x: auto;
		padding: 0.5em;
		max-width: 96ch;
		width: calc(100vw - 3rem);
	}
	@media only screen and (max-width: 820px) {
		.oak-notebook-panel table {
			font-size: calc(1em - 2px);
		}
	}
</style>
<main aria-role="main">
	<article class="overlay notebook">
		<h1>Oak Notebook ðŸ§ª</h1><div class="meta">
    <a href="https://oaklang.org/" target="_blank">â†– Back to Oak</a>
    <a href="https://github.com/thesephist/x-oak-notebook" target="_blank">See on GitHub â†’</a>
</div><p><strong>Oak Notebook</strong> is an experimental tool for authoring <a href="https://thesephist.com/posts/notation/#dynamic-notation">dynamic documents</a> with Markdown and <a href="https://oaklang.org/">Oak</a>. Oak Notebook is a way of writing documents with interactive, programmable "panels" for explaining and exploring complex ideas, and a "compiler" script that transforms such Markdown documents into HTML web pages.</p><p>I was inspired initially by <a href="https://docs.streamlit.io/library/api-reference">Streamlit</a> and <a href="http://worrydream.com/ScrubbingCalculator/">Bret Victor's Scrubbing Calculator</a> to explore ideas in this space, but what's here isn't a specific re-implementation of either of those concepts, and takes further inspirations from other products, experiments, and prior art.</p><p>For a demonstrative example, I want to introduce you to two interesting formulas for estimating the value of Ï€. They're both derived from the <a href="https://en.wikipedia.org/wiki/Machin-like_formula">approximations of Ï€ using properties of the arctangent function</a>.</p><p>$$ \pi = 4 \arctan(1) = 4 \left( 1 - \frac{1}{3} + \frac{1}{5} - \frac{1}{7} + \frac{1}{9} - \cdots \right) $$</p><p>$$ \pi = 6 \arctan\left(\frac{1}{\sqrt{3}}\right) = \frac{6}{\sqrt{3}} \left( 1 - \frac{1}{3 \times 3} + \frac{1}{5 \times 3^2} - \frac{1}{7 \times 3^3} + \cdots \right) $$</p><p>They approach the true vale of Ï€ at different rates, but it's difficult to get a sense of what those approximations look like, how close they are, or what some specific margin of error really means. One way to get a better grasp of these concepts is through this panel. (Try tapping and dragging on the underlined number to adjust it.)</p><div class="oak-notebook-panel panel-8"></div><p>Oak Notebook provides a way to write these interactive panels without worrying about user interfaces or managing rich user input components.</p><h2>Guiding principles</h2><p><strong>Composability</strong>. Authors should be able to compose and reuse customized groups of widgets by just writing Oak functions.</p><p><strong>End-user programmability</strong>.</p><h2>Widget library</h2><h3>Input widgets</h3><p><strong>Button</strong></p><pre><code data-lang="oak"><span class="oak-identifier">counter </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">button</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Count up!'</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">label</span><span class="oak-leftParen">(</span><span class="oak-identifier">counter</span><span class="oak-dot">.</span><span class="oak-identifier">count</span><span class="oak-comma">, </span><span class="oak-stringLiteral">'clicks,'</span><span class="oak-newline">
        </span><span class="oak-stringLiteral">'last clicked'</span><span class="oak-comma">, </span><span class="oak-identifier">datetime</span><span class="oak-dot">.</span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-fnName">int</span><span class="oak-leftParen">(</span><span class="oak-identifier">counter</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">label</span><span class="oak-leftParen">(</span><span class="oak-newline">
        </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">range</span><span class="oak-leftParen">(</span><span class="oak-identifier">counter</span><span class="oak-dot">.</span><span class="oak-identifier">count</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
            </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn </span><span class="oak-stringLiteral">'ðŸŒˆ'</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
            </span><span class="oak-identifier">str</span><span class="oak-dot">.</span><span class="oak-fnName">join</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">' '</span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-17"></div><p><strong>Checkbox</strong></p><pre><code data-lang="oak"><span class="oak-identifier">light </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">checkbox</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Light switch'</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-withKeyword">with </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">label</span><span class="oak-leftParen">(</span><span class="oak-rightParen">) </span><span class="oak-ifKeyword">if </span><span class="oak-identifier">light</span><span class="oak-dot">.</span><span class="oak-identifier">checked </span><span class="oak-leftBrace">{</span><span class="oak-newline">
        </span><span class="oak-trueLiteral">true </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'ðŸ’¡ Lights on!'</span><span class="oak-newline">
        </span><span class="oak-underscore">_ </span><span class="oak-branchArrow">-> </span><span class="oak-stringLiteral">'ðŸ”¦ Light off...'</span><span class="oak-newline">
    </span><span class="oak-rightBrace">}</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-20"></div><p><strong>Number</strong></p><pre><code data-lang="oak"><span class="oak-identifier">first </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">number</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'First number'</span><span class="oak-comma">, </span><span class="oak-numberLiteral">2</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-numberLiteral">10</span><span class="oak-comma">, </span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span>
<span class="oak-identifier">second </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">number</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Second number'</span><span class="oak-comma">, </span><span class="oak-numberLiteral">3</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-numberLiteral">10</span><span class="oak-comma">, </span><span class="oak-numberLiteral">1</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">label</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'{{0}} Ã— {{1}} = {{2}}' </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">fmt</span><span class="oak-dot">.</span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-identifier">first</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-comma">, </span><span class="oak-identifier">second</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-comma">, </span><span class="oak-identifier">first</span><span class="oak-dot">.</span><span class="oak-identifier">value </span><span class="oak-times">* </span><span class="oak-identifier">second</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-rightParen">)</span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-23"></div><p><strong>Scrubbable</strong></p><pre><code data-lang="oak"><span class="oak-identifier">rotation </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">scrubbable</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">30</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-numberLiteral">720</span><span class="oak-comma">, </span><span class="oak-numberLiteral">1</span><span class="oak-comma">, </span><span class="oak-leftBracket">[</span><span class="oak-stringLiteral">'Rotate me by '</span><span class="oak-comma">, </span><span class="oak-stringLiteral">'Âº'</span><span class="oak-rightBracket">]</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
	</span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">html</span><span class="oak-leftParen">(</span><span class="oak-newline">
		</span><span class="oak-stringLiteral">'&lt;div style="
            transform: rotate({{0}}deg);
            height: 100px;
            width: 100px;
            display: flex;
            align-items: center;
            justify-content: center">HELLO&lt;/div>' </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
            </span><span class="oak-identifier">fmt</span><span class="oak-dot">.</span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-identifier">rotation</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-rightParen">)</span><span class="oak-newline">
	</span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-26"></div><p><strong>Text</strong></p><pre><code data-lang="oak"><span class="oak-identifier">input </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">text</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Tell me a sentence'</span><span class="oak-comma">, </span><span class="oak-stringLiteral">'The quick brown fox jumped over the lazy dog'</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">wordCount </span><span class="oak-assign">:= </span><span class="oak-identifier">input</span><span class="oak-dot">.</span><span class="oak-identifier">value </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">str</span><span class="oak-dot">.</span><span class="oak-fnName">split</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">' '</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">filter</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">s</span><span class="oak-rightParen">) </span><span class="oak-identifier">s </span><span class="oak-neq">!= </span><span class="oak-stringLiteral">''</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">label</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'There are'</span><span class="oak-comma">, </span><span class="oak-identifier">wordCount</span><span class="oak-comma">, </span><span class="oak-stringLiteral">'words in this sentence!'</span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-29"></div><p><strong>Prose</strong></p><pre><code data-lang="oak"><span class="oak-identifier">paragraph </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">prose</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Story'</span><span class="oak-comma">, </span><span class="oak-stringLiteral">'All human beings are born free and equal in dignity and rights. They are endowed with reason and conscience and should act towards one another in a spirit of brotherhood.'</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">words </span><span class="oak-assign">:= </span><span class="oak-identifier">paragraph</span><span class="oak-dot">.</span><span class="oak-identifier">value </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">filter</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-identifier">str</span><span class="oak-dot">.</span><span class="oak-fnName">letter?</span><span class="oak-leftParen">(</span><span class="oak-identifier">c</span><span class="oak-rightParen">) </span><span class="oak-or">| </span><span class="oak-identifier">c </span><span class="oak-eq">= </span><span class="oak-stringLiteral">' '</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">str</span><span class="oak-dot">.</span><span class="oak-fnName">lower</span><span class="oak-leftParen">(</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">str</span><span class="oak-dot">.</span><span class="oak-fnName">split</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">' '</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">compact</span><span class="oak-leftParen">(</span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-identifier">uniqWords </span><span class="oak-assign">:= </span><span class="oak-identifier">words </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">sort</span><span class="oak-dot">.</span><span class="oak-fnName">sort</span><span class="oak-leftParen">(</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|></span><span class="oak-newline">
        </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">uniq</span><span class="oak-leftParen">(</span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">table</span><span class="oak-leftParen">(</span><span class="oak-newline">
        </span><span class="oak-identifier">uniqWords </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">map</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">word</span><span class="oak-rightParen">) </span><span class="oak-leftBrace">{</span><span class="oak-newline">
            </span><span class="oak-identifier">word</span><span class="oak-colon">: </span><span class="oak-identifier">word</span><span class="oak-newline">
            </span><span class="oak-identifier">count</span><span class="oak-colon">: </span><span class="oak-identifier">words </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">filter</span><span class="oak-leftParen">(</span><span class="oak-fnKeyword">fn</span><span class="oak-leftParen">(</span><span class="oak-identifier">w</span><span class="oak-rightParen">) </span><span class="oak-identifier">w </span><span class="oak-eq">= </span><span class="oak-identifier">word</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-fnName">len</span><span class="oak-leftParen">(</span><span class="oak-rightParen">)</span><span class="oak-newline">
        </span><span class="oak-rightBrace">}</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">sort</span><span class="oak-dot">.</span><span class="oak-fnName">sort</span><span class="oak-leftParen">(</span><span class="oak-colon">:</span><span class="oak-identifier">count</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">reverse</span><span class="oak-leftParen">(</span><span class="oak-rightParen">) </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">std</span><span class="oak-dot">.</span><span class="oak-fnName">take</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">10</span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-32"></div><p><strong>Select</strong></p><pre><code data-lang="oak"><span class="oak-identifier">color </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">select</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Color'</span><span class="oak-comma">, </span><span class="oak-leftBracket">[</span><span class="oak-newline">
    </span><span class="oak-stringLiteral">'Red'</span><span class="oak-newline">
    </span><span class="oak-stringLiteral">'Blue'</span><span class="oak-newline">
    </span><span class="oak-stringLiteral">'Green'</span><span class="oak-newline">
    </span><span class="oak-stringLiteral">'Yellow'</span>
<span class="oak-rightBracket">]</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">html</span><span class="oak-leftParen">(</span><span class="oak-newline">
        </span><span class="oak-identifier">fmt</span><span class="oak-dot">.</span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-newline">
            </span><span class="oak-stringLiteral">'&lt;div style="height:100px;width:100px;border-radius:4px;background:{{ 0 }}">&lt;/div>'</span><span class="oak-newline">
            </span><span class="oak-identifier">color</span><span class="oak-dot">.</span><span class="oak-identifier">value </span><span class="oak-pipeArrow">|> </span><span class="oak-identifier">str</span><span class="oak-dot">.</span><span class="oak-fnName">lower</span><span class="oak-leftParen">(</span><span class="oak-rightParen">)</span><span class="oak-newline">
        </span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-35"></div><h3>Display widgets</h3><ul><li>Graph or plot</li><li>2D color map<ul><li>Path or surface over 2D canvas</li></ul></li><li>LaTeX formula with KaTeX, perhaps using the KaTeX-language code fence</li></ul><p><strong>Label</strong></p><pre><code data-lang="oak"><span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">label</span><span class="oak-leftParen">(</span><span class="oak-stringLiteral">'Hello, World!'</span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-40"></div><p><strong>Table</strong></p><div class="oak-notebook-panel panel-42"></div><div class="oak-notebook-panel panel-43"></div><p><strong>HTML</strong></p><pre><code data-lang="oak"><span class="oak-identifier">r </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">scrubbable</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">180</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-numberLiteral">255</span><span class="oak-comma">, </span><span class="oak-numberLiteral">1</span><span class="oak-comma">, </span><span class="oak-leftBracket">[</span><span class="oak-stringLiteral">'Red: '</span><span class="oak-comma">, </span><span class="oak-stringLiteral">''</span><span class="oak-rightBracket">]</span><span class="oak-rightParen">)</span>
<span class="oak-identifier">g </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">scrubbable</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">190</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-numberLiteral">255</span><span class="oak-comma">, </span><span class="oak-numberLiteral">1</span><span class="oak-comma">, </span><span class="oak-leftBracket">[</span><span class="oak-stringLiteral">'Green: '</span><span class="oak-comma">, </span><span class="oak-stringLiteral">''</span><span class="oak-rightBracket">]</span><span class="oak-rightParen">)</span>
<span class="oak-identifier">b </span><span class="oak-assign">:= </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">scrubbable</span><span class="oak-leftParen">(</span><span class="oak-numberLiteral">216</span><span class="oak-comma">, </span><span class="oak-numberLiteral">0</span><span class="oak-comma">, </span><span class="oak-numberLiteral">255</span><span class="oak-comma">, </span><span class="oak-numberLiteral">1</span><span class="oak-comma">, </span><span class="oak-leftBracket">[</span><span class="oak-stringLiteral">'Blue: '</span><span class="oak-comma">, </span><span class="oak-stringLiteral">''</span><span class="oak-rightBracket">]</span><span class="oak-rightParen">)</span>

<span class="oak-fnKeyword">fn </span><span class="oak-fnName">display </span><span class="oak-leftBrace">{</span><span class="oak-newline">
    </span><span class="oak-identifier">nb</span><span class="oak-dot">.</span><span class="oak-fnName">html</span><span class="oak-leftParen">(</span><span class="oak-newline">
        </span><span class="oak-identifier">fmt</span><span class="oak-dot">.</span><span class="oak-fnName">format</span><span class="oak-leftParen">(</span><span class="oak-newline">
            </span><span class="oak-stringLiteral">'&lt;div style="height:100px;width:100px;border-radius:4px;background:rgb({{0}},{{1}},{{2}})">&lt;/div>'</span><span class="oak-newline">
            </span><span class="oak-identifier">r</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-comma">, </span><span class="oak-identifier">g</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-comma">, </span><span class="oak-identifier">b</span><span class="oak-dot">.</span><span class="oak-identifier">value</span><span class="oak-newline">
        </span><span class="oak-rightParen">)</span><span class="oak-newline">
    </span><span class="oak-rightParen">)</span>
<span class="oak-rightBrace">}</span></code></pre><div class="oak-notebook-panel panel-46"></div><h2>Limitations and future directions</h2><ul><li>Global and panel-local persistent state</li><li>Bidirectional bindings to and from inputs -- what if we want to adjust one input with another input?</li><li>gnuplot-like syntax for describing plots and graphs easily:</li></ul><pre><code>f(x) = exp(-x**2 / 2)
plot [t=-4:4] f(t), t**2 / 16

plot [t=-4:4] f(t) title "Bell Curve", t**2 / 16 title "Parabola"</code></pre><h2>Inspirations and further reading</h2><ul><li>Bret Victor's <a href="http://worrydream.com/ScrubbingCalculator/">Scrubbing Calculator</a> and <a href="http://worrydream.com/LadderOfAbstraction/">Up and Down the Ladder of Abstraction</a></li><li><a href="https://streamlit.io/">Streamlit</a> and <a href="https://jupyter.org/">Jupyter Notebook</a></li><li><a href="https://mdxjs.com/">MDX</a>, a superset of Markdown with support for embedded React components</li><li><a href="https://explorabl.es/">Explorable Explanations</a>, a collection of interactive explanatory essays on dynamical systems</li></ul>
	</article>
</main>
<script>
	/* oak build --web */
// module system
const __Oak_Modules = {};
let __Oak_Import_Aliases;
function __oak_modularize(name, fn) {
	__Oak_Modules[name] = fn;
}
function __oak_module_import(name) {
	if (typeof __Oak_Modules[name] === 'object') return __Oak_Modules[name];
	const module = __Oak_Modules[name] || __Oak_Modules[__Oak_Import_Aliases[name]];
	if (module) {
		__Oak_Modules[name] = {}; // break circular imports
		return __Oak_Modules[name] = module();
	} else {
		throw new Error(`Could not import Oak module "${name}" at runtime`);
	}
}

// language primitives
let __oak_empty_assgn_tgt;
function __oak_eq(a, b) {
	if (a === __Oak_Empty || b === __Oak_Empty) return true;

	// match either null or undefined to compare correctly against undefined ?s
	// appearing in places like optional arguments
	if (a == null && b == null) return true;
	if (a == null || b == null) return false;

	// match all other types that can be compared cheaply (without function
	// calls for type coercion or recursive descent)
	if (typeof a === 'boolean' || typeof a === 'number' ||
		typeof a === 'symbol' || typeof a === 'function') {
		return a === b;
	}

	// string equality check
	a = __as_oak_string(a);
	b = __as_oak_string(b);
	if (typeof a !== typeof b) return false;
	if (__is_oak_string(a) && __is_oak_string(b)) {
		return a.valueOf() === b.valueOf();
	}

	// deep equality check for composite values
	if (len(a) !== len(b)) return false;
	for (const key of keys(a)) {
		if (!__oak_eq(a[key], b[key])) return false;
	}
	return true;
}
function __oak_acc(tgt, prop) {
	return (__is_oak_string(tgt) ? __as_oak_string(tgt.valueOf()[prop]) : tgt[prop]) ?? null;
}
function __oak_obj_key(x) {
	return typeof x === 'symbol' ? Symbol.keyFor(x) : x;
}
function __oak_push(a, b) {
	a = __as_oak_string(a);
	a.push(b);
	return a;
}
function __oak_and(a, b) {
	if (typeof a === 'boolean' && typeof b === 'boolean') {
		return a && b;
	}
	if (__is_oak_string(a) && __is_oak_string(b)) {
		const max = Math.max(a.length, b.length);
		const get = (s, i) => s.valueOf().charCodeAt(i) || 0;

		let res = '';
		for (let i = 0; i < max; i ++) {
			res += String.fromCharCode(get(a, i) & get(b, i));
		}
		return res;
	}
	return a & b;
}
function __oak_or(a, b) {
	if (typeof a === 'boolean' && typeof b === 'boolean') {
		return a || b;
	}
	if (__is_oak_string(a) && __is_oak_string(b)) {
		const max = Math.max(a.length, b.length);
		const get = (s, i) => s.valueOf().charCodeAt(i) || 0;

		let res = '';
		for (let i = 0; i < max; i ++) {
			res += String.fromCharCode(get(a, i) | get(b, i));
		}
		return res;
	}
	return a | b;
}
function __oak_xor(a, b) {
	if (typeof a === 'boolean' && typeof b === 'boolean') {
		return (a && !b) || (!a && b);
	}
	if (__is_oak_string(a) && __is_oak_string(b)) {
		const max = Math.max(a.length, b.length);
		const get = (s, i) => s.valueOf().charCodeAt(i) || 0;

		let res = '';
		for (let i = 0; i < max; i ++) {
			res += String.fromCharCode(get(a, i) ^ get(b, i));
		}
		return res;
	}
	return a ^ b;
}
const __Oak_Empty = Symbol('__Oak_Empty');

// mutable string type
function __is_oak_string(x) {
	if (x == null) return false;
	return x.__mark_oak_string;
}
function __as_oak_string(x) {
	if (typeof x === 'string') return __Oak_String(x);
	return x;
}
const __Oak_String = s => {
	return {
		__mark_oak_string: true,
		assign(i, slice) {
			if (i === s.length) return s += slice;
			return s = s.substr(0, i) + slice + s.substr(i + slice.length);
		},
		push(slice) {
			s += slice;
		},
		toString() {
			return s;
		},
		valueOf() {
			return s;
		},
		get length() {
			return s.length;
		},
	}
}

// tail recursion trampoline helpers
function __oak_resolve_trampoline(fn, ...args) {
	let rv = fn(...args);
	while (rv && rv.__is_oak_trampoline) {
		rv = rv.fn(...rv.args);
	}
	return rv;
}
function __oak_trampoline(fn, ...args) {
	return {
		__is_oak_trampoline: true,
		fn: fn,
		args: args,
	}
}

// env (builtin) functions

// reflection and types
const __Is_Oak_Node = typeof process === 'object';
const __Oak_Int_RE = /^[+-]?\d+$/;
function int(x) {
	x = __as_oak_string(x);
	if (typeof x === 'number') {
		// JS rounds towards higher magnitude, Oak rounds towards higher value
		const rounded = Math.floor(x);
		const diff = x - rounded;
		if (x < 0 && diff === 0.5) return rounded + 1;
		return rounded;
	}
	if (__is_oak_string(x) && __Oak_Int_RE.test(x.valueOf())) {
		const i = Number(x.valueOf());
		if (isNaN(i)) return null;
		return i;
	}
	return null;
}
function float(x) {
	x = __as_oak_string(x);
	if (typeof x === 'number') return x;
	if (__is_oak_string(x)) {
		const f = parseFloat(x.valueOf());
		if (isNaN(f)) return null;
		return f;
	}
	return null;
}
function atom(x) {
	x = __as_oak_string(x);
	if (typeof x === 'symbol' && x !== __Oak_Empty) return x;
	if (__is_oak_string(x)) return Symbol.for(x.valueOf());
	return Symbol.for(string(x));
}
function string(x) {
	x = __as_oak_string(x);
	function display(x) {
		x = __as_oak_string(x);
		if (__is_oak_string(x)) {
			return '\'' + x.valueOf().replace('\\', '\\\\').replace('\'', '\\\'') + '\'';
		} else if (typeof x === 'symbol') {
			if (x === __Oak_Empty) return '_';
			return ':' + Symbol.keyFor(x);
		}
		return string(x);
	}
	if (x == null) {
		return '?';
	} else if (typeof x === 'number') {
		return x.toString();
	} else if (__is_oak_string(x)) {
		return x;
	} else if (typeof x === 'boolean') {
		return x.toString();
	} else if (typeof x === 'function') {
		return x.toString();
	} else if (typeof x === 'symbol') {
		if (x === __Oak_Empty) return '_';
		return Symbol.keyFor(x);
	} else if (Array.isArray(x)) {
		return '[' + x.map(display).join(', ') + ']';
	} else if (typeof x === 'object') {
		const entries = [];
		for (const key of keys(x).sort()) {
			entries.push(`${key}: ${display(x[key])}`);
		}
		return '{' + entries.join(', ') + '}';
	}
	throw new Error('string() called on unknown type ' + x.toString());
}
function codepoint(c) {
	c = __as_oak_string(c);
	return c.valueOf().charCodeAt(0);
}
function char(n) {
	return String.fromCharCode(n);
}
function type(x) {
	x = __as_oak_string(x);
	if (x == null) {
		return Symbol.for('null');
	} else if (typeof x === 'number') {
		// Many discrete APIs check for :int, so we consider all integer
		// numbers :int and fall back to :float. This is not an airtight
		// solution, but works well enough and the alternative (tagged number
		// values/types) have poor perf tradeoffs.
		if (Number.isInteger(x)) return Symbol.for('int');
		return Symbol.for('float');
	} else if (__is_oak_string(x)) {
		return Symbol.for('string');
	} else if (typeof x === 'boolean') {
		return Symbol.for('bool');
	} else if (typeof x === 'symbol') {
		if (x === __Oak_Empty) return Symbol.for('empty');
		return Symbol.for('atom');
	} else if (typeof x === 'function') {
		return Symbol.for('function');
	} else if (Array.isArray(x)) {
		return Symbol.for('list');
	} else if (typeof x === 'object') {
		return Symbol.for('object');
	}
	throw new Error('type() called on unknown type ' + x.toString());
}
function len(x) {
	if (typeof x === 'string' || __is_oak_string(x) || Array.isArray(x)) {
		return x.length;
	} else if (typeof x === 'object' && x !== null) {
		return Object.getOwnPropertyNames(x).length;
	}
	throw new Error('len() takes a string or composite value, but got ' + string(x));
}
function keys(x) {
	if (Array.isArray(x)) {
		const k = [];
		for (let i = 0; i < x.length; i ++) k.push(i);
		return k;
	} else if (typeof x === 'object' && x !== null) {
		return Object.getOwnPropertyNames(x).map(__as_oak_string);
	}
	throw new Error('keys() takes a composite value, but got ' + string(x).valueOf());
}

// OS interfaces
function args() {
	if (__Is_Oak_Node) return process.argv.map(__as_oak_string);
	return [window.location.href];
}
function env() {
	if (__Is_Oak_Node) {
		const e = Object.assign({}, process.env);
		for (const key in e) {
			e[key] = __as_oak_string(e[key]);
		}
		return e;
	}
	return {};
}
function time() {
	return Date.now() / 1000;
}
function nanotime() {
	return int(Date.now() * 1000000);
}
function rand() {
	return Math.random();
}
let randomBytes;
function srand(length) {
	if (__Is_Oak_Node) {
		// lazily import dependency
		if (!randomBytes) randomBytes = require('crypto').randomBytes;
		return randomBytes(length).toString('latin1');
	}

	const bytes = crypto.getRandomValues(new Uint8Array(length));
	return __as_oak_string(Array.from(bytes).map(b => String.fromCharCode(b)).join(''));
}
function wait(duration, cb) {
	setTimeout(cb, duration * 1000);
	return null;
}
function exit(code) {
	if (__Is_Oak_Node) process.exit(code);
	return null;
}
function exec() {
	throw new Error('exec() not implemented');
}

// I/O
function input() {
	throw new Error('input() not implemented');
}
function print(s) {
	s = __as_oak_string(s);
	if (__Is_Oak_Node) {
		process.stdout.write(string(s).toString());
	} else {
		console.log(string(s).toString());
	}
	return s.length;
}
function ls() {
	throw new Error('ls() not implemented');
}
function rm() {
	throw new Error('rm() not implemented');
}
function mkdir() {
	throw new Error('mkdir() not implemented');
}
function stat() {
	throw new Error('stat() not implemented');
}
function open() {
	throw new Error('open() not implemented');
}
function close() {
	throw new Error('close() not implemented');
}
function read() {
	throw new Error('read() not implemented');
}
function write() {
	throw new Error('write() not implemented');
}
function listen() {
	throw new Error('listen() not implemented');
}
function req() {
	throw new Error('req() not implemented');
}

// math
function sin(n) {
	return Math.sin(n);
}
function cos(n) {
	return Math.cos(n);
}
function tan(n) {
	return Math.tan(n);
}
function asin(n) {
	return Math.asin(n);
}
function acos(n) {
	return Math.acos(n);
}
function atan(n) {
	return Math.atan(n);
}
function pow(b, n) {
	return Math.pow(b, n);
}
function log(b, n) {
	return Math.log(n) / Math.log(b);
}

// runtime
function ___runtime_lib() {
	throw new Error('___runtime_lib() not implemented');
}
function ___runtime_lib__oak_qm() {
	throw new Error('___runtime_lib?() not implemented');
}
function ___runtime_gc() {
	throw new Error('___runtime_gc() not implemented');
}
function ___runtime_mem() {
	throw new Error('___runtime_mem() not implemented');
}

// JavaScript interop
function call(target, fn, ...args) {
	return target[Symbol.keyFor(fn)](...args);
}
function __oak_js_new(Constructor, ...args) {
	return new Constructor(...args);
}
function __oak_js_try(fn) {
	try {
		return {
			type: Symbol.for('ok'),
			ok: fn(),
		}
	} catch (e) {
		return {
			type: Symbol.for('error'),
			error: e,
		}
	}
}
(__oak_modularize(__Oak_String(``),function _(){return ((Notebook,datetime,debug,fmt,math,md,panel_17,panel_20,panel_23,panel_26,panel_29,panel_32,panel_35,panel_40,panel_42,panel_43,panel_46,panel_8,sort,std,str)=>((std=__oak_module_import(__Oak_String(`std`))),(str=__oak_module_import(__Oak_String(`str`))),(math=__oak_module_import(__Oak_String(`math`))),(sort=__oak_module_import(__Oak_String(`sort`))),(fmt=__oak_module_import(__Oak_String(`fmt`))),(datetime=__oak_module_import(__Oak_String(`datetime`))),(debug=__oak_module_import(__Oak_String(`debug`))),(md=__oak_module_import(__Oak_String(`md`))),Notebook=function Notebook(i=null){return ((_input,_wrapInLabel,button,checkbox,display,displayEl,displayOutputs,el,html,label,number,plot,prose,register,scrubbable,select,table,text)=>((el=(document.querySelector)(__as_oak_string(__Oak_String(`.oak-notebook-panel.panel-`)+string(i)))),(displayEl=null),(displayOutputs=function _(){return null}),_wrapInLabel=function _wrapInLabel(labelName=null,inputEl=null){return ((labelEl,labelText)=>((labelText=(document.createElement)(__Oak_String(`div`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(className,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.className):(__oak_assgn_tgt.className)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(labelText),__Oak_String(`labelText`)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(labelText),labelName),(labelEl=(document.createElement)(__Oak_String(`label`))),(labelEl.appendChild)(labelText),(labelEl.appendChild)(inputEl),labelEl))()},_input=function _input(type=null,labelName=null,value=null,attrs=null){return ((inputEl,labelEl)=>((inputEl=(document.createElement)(((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('textarea'))?__Oak_String(`textarea`):__Oak_String(`input`))(type))),((__oak_cond)=>__oak_eq(__oak_cond,true)?((inputEl.setAttribute)(__Oak_String(`type`),string(type))):null)(!__oak_eq(type,Symbol.for('textarea'))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(value,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.value):(__oak_assgn_tgt.value)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(inputEl),value),(std.each)((std.entries)((std.__oak_js_default)(attrs,({}))),function _(entry=null){return ((attr,val)=>(([attr=null,val=null]=entry),((__oak_cond)=>__oak_eq(__oak_cond,true)?(inputEl.setAttribute)(attr,val):null)(!__oak_eq(val,null))))()}),(inputEl.addEventListener)(__Oak_String(`input`),function _(){return (display())}),(labelEl=_wrapInLabel(labelName,inputEl)),((labelEl.classList??null).add)(__as_oak_string(__Oak_String(`type-`)+string(type))),(el.appendChild)(labelEl),inputEl))()},number=function number(labelName=null,value=null,min=null,max=null,step=null){return (_input(Symbol.for('number'),labelName,value,({min,max,step})))},scrubbable=function scrubbable(value=null,min=null,max=null,step=null,fmtSpec=null){return ((after,before,clientX,clipByStep,formatParagraph,initialValue,inputEl,resetButton,scrubObj,startValue,startX)=>((step=(std.__oak_js_default)(step,1)),(fmtSpec=(std.__oak_js_default)(fmtSpec,[__Oak_String(``),__Oak_String(``)])),(inputEl=(document.createElement)(__Oak_String(`span`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(className,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.className):(__oak_assgn_tgt.className)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(inputEl),__Oak_String(`oak-notebook-scrubbable`)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(inputEl),value),(resetButton=(document.createElement)(__Oak_String(`button`))),((resetButton.classList??null).add)(__Oak_String(`resetButton`)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(resetButton),__Oak_String(`reset`)),(resetButton.addEventListener)(__Oak_String(`click`),function _(){return ((value=initialValue),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(inputEl),string(value)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(value,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.value):(__oak_assgn_tgt.value)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(scrubObj),value),(formatParagraph.removeChild)(resetButton),display())}),clientX=function clientX(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?(evt.clientX??null):(__oak_acc((evt.touches??null),__oak_obj_key((0))).clientX??null))((evt.touches??null))},clipByStep=function clipByStep(n=null){return (__as_oak_string(min+(int((((__as_oak_string(n+(step/2))-min))/step))*step)))},(initialValue=value),(startX=null),(startValue=null),(scrubObj=({value})),(std.each)([[__Oak_String(`mousedown`),__Oak_String(`mouseup`),__Oak_String(`mousemove`)],[__Oak_String(`touchstart`),__Oak_String(`touchend`),__Oak_String(`touchmove`)]],function _(events=null){return ((begin,end,handleMove,move)=>(([begin=null,end=null,move=null]=events),handleMove=function handleMove(evt=null){return ((evt.preventDefault)(),(value=(math.clamp)(clipByStep(__as_oak_string(startValue+(math.scale)(((clientX(evt)-startX)),0,(math.min)((window.innerWidth??null),((20*((max-min)))/step)),0,(max-min)))),min,max)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(inputEl),string(value)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(value,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.value):(__oak_assgn_tgt.value)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(scrubObj),value),((__oak_cond)=>__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(formatParagraph.contains)(resetButton)))(__oak_eq(value,initialValue)))?(formatParagraph.removeChild)(resetButton):__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,!(formatParagraph.contains)(resetButton)))(!__oak_eq(value,initialValue)))?(formatParagraph.appendChild)(resetButton):null)(true),display())},(inputEl.addEventListener)(begin,function _(evt=null){return ((evt.preventDefault)(),(startX=clientX(evt)),(startValue=value),(((document.body??null).classList??null).add)(__Oak_String(`scrubbing`)),((document.body??null).addEventListener)(move,handleMove),((document.body??null).addEventListener)(end,function _(){return ((evt.preventDefault)(),(((document.body??null).classList??null).remove)(__Oak_String(`scrubbing`)),((document.body??null).removeEventListener)(move,handleMove))}))})))()}),(formatParagraph=(document.createElement)(__Oak_String(`p`))),([before=null,after=null]=(std.map)(fmtSpec,function _(text=null){return (document.createTextNode)(text)})),(formatParagraph.appendChild)(before),(formatParagraph.appendChild)(inputEl),(formatParagraph.appendChild)(after),(el.appendChild)(formatParagraph),scrubObj))()},checkbox=function checkbox(labelName=null){return (_input(Symbol.for('checkbox'),labelName))},text=function text(labelName=null,value=null){return (_input(Symbol.for('text'),labelName,value))},prose=function prose(labelName=null,value=null){return (_input(Symbol.for('textarea'),labelName,value))},select=function select(labelName=null,options=null){return ((createOption,selectEl)=>(createOption=function createOption(value=null){return ((opt)=>((opt=(document.createElement)(__Oak_String(`option`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(value,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.value):(__oak_assgn_tgt.value)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(opt),value),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(opt),value)))()},(selectEl=(document.createElement)(__Oak_String(`select`))),(selectEl.append)(...(std.map)(options,createOption)),(selectEl.addEventListener)(__Oak_String(`change`),function _(){return [display()]}),(el.appendChild)(_wrapInLabel(labelName,selectEl)),selectEl))()},button=function button(value=null){return ((b,buttonObj)=>((buttonObj=({count:0,value:time()})),(b=(document.createElement)(__Oak_String(`button`))),((b.classList??null).add)(__Oak_String(`button`)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(b),value),(b.addEventListener)(__Oak_String(`click`),function _(){return (((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(count,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.count):(__oak_assgn_tgt.count)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(buttonObj),__as_oak_string((buttonObj.count??null)+1)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(value,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.value):(__oak_assgn_tgt.value)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(buttonObj),time()),display())}),(el.appendChild)(b),buttonObj))()},label=function label(...s){return ((p)=>((p=(document.createElement)(__Oak_String(`p`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(innerHTML,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.innerHTML):(__oak_assgn_tgt.innerHTML)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(p),(md.transform)((str.join)(s,__Oak_String(` `)))),(displayEl.appendChild)(p)))()},table=function table(entries=null){return ((__oak_trampolined_table)=>((__oak_trampolined_table=function _(entries=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('object'))?((columns,header,tb,tbContainer)=>((columns=keys((std.merge)(({}),...entries))),(tb=(document.createElement)(__Oak_String(`table`))),(header=(document.createElement)(__Oak_String(`tr`))),(tb.appendChild)(header),(std.each)(columns,function _(col=null){return ((th)=>((th=(document.createElement)(__Oak_String(`th`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(th),col),(header.appendChild)(th)))()}),(std.each)(entries,function _(entry=null){return ((tr)=>((tr=(document.createElement)(__Oak_String(`tr`))),(std.each)(columns,function _(col=null){return ((td,val)=>((td=(document.createElement)(__Oak_String(`td`))),(val=__oak_acc(entry,__oak_obj_key((col)))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(td),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('int'))?string(val):__oak_eq(__oak_cond,Symbol.for('float'))?string(val):__oak_eq(__oak_cond,Symbol.for('string'))?string(val):(debug.inspect)(val))(type(val))),(tr.appendChild)(td)))()}),(tb.appendChild)(tr)))()}),(tbContainer=(document.createElement)(__Oak_String(`div`))),((tbContainer.classList??null).add)(__Oak_String(`table-container`)),(tbContainer.appendChild)(tb),(displayEl.appendChild)(tbContainer)))():__oak_trampoline(__oak_trampolined_table,(std.map)(entries,function _(x=null){return ({value:x})})))(type(__oak_acc(entries,0)))}),__oak_resolve_trampoline(__oak_trampolined_table,entries)))()},plot=function plot(f=null,domain=null,range=null){return null},html=function html(innerHTML=null){return ((template)=>((template=(document.createElement)(__Oak_String(`template`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(innerHTML,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.innerHTML):(__oak_assgn_tgt.innerHTML)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(template),String(innerHTML)),(displayEl.appendChild)((template.content??null))))()},register=function register(display=null){return ((displayOutputs=display))},display=function display(){return (requestAnimationFrame(function _(){return ((evt)=>(((__oak_cond)=>__oak_eq(__oak_cond,true)?(displayEl=((displayEl)=>((displayEl=(document.createElement)(__Oak_String(`div`))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(className,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.className):(__oak_assgn_tgt.className)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(displayEl),__Oak_String(`oak-notebook-display`)),(el.appendChild)(displayEl),displayEl))()):null)(__oak_eq(displayEl,null)),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(textContent,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.textContent):(__oak_assgn_tgt.textContent)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(displayEl),__Oak_String(``)),(evt=__oak_js_try(displayOutputs)),((__oak_cond)=>__oak_eq(__oak_cond,true)?(std.println)(__Oak_String(`Error:`),(evt.error??null)):null)(__oak_eq((evt.type??null),Symbol.for('error')))))()}))},({number,checkbox,scrubbable,prose,text,button,select,label,table,plot,html,register,display})))()},panel_8=function panel_8(){return ((display,max,nb,units)=>((nb=Notebook(8)),(max=(nb.scrubbable)(3,1,12,1,[__Oak_String(`Estimate Ï€ with `),__Oak_String(` terms.`)])),(units=(nb.select)(__Oak_String(`Units`),[__Oak_String(`Kilometers`),__Oak_String(`Miles`)])),display=function display(){return ((EarthCircumference,nums,oneError,rootThreeError)=>((nums=(std.range)((max.value??null))),(oneError=null),(rootThreeError=null),(nb.table)([((error,estimate,sequence)=>((sequence=(std.map)(nums,function _(n=null){return ((odd,sign)=>((sign=((__oak_cond)=>__oak_eq(__oak_cond,0)?1:-1)((n%2))),(odd=__as_oak_string((2*n)+1)),(sign/odd)))()})),(estimate=(4*(math.sum)(...sequence))),(error=(math.abs)(((math.Pi??null)-estimate))),(oneError=error),({Angle:__Oak_String(`1`),[__Oak_String(`Estimate for Ï€`)]:estimate,Error:error,[__Oak_String(`% Error`)]:__as_oak_string(string((math.round)(((error/estimate)*100),6))+__Oak_String(`%`))})))(),((error,estimate,sequence,x)=>((x=(1/(math.sqrt)(3))),(sequence=(std.map)(nums,function _(n=null){return ((odd,sign)=>((sign=((__oak_cond)=>__oak_eq(__oak_cond,0)?1:-1)((n%2))),(odd=__as_oak_string((2*n)+1)),((sign*pow(x,odd))/odd)))()})),(estimate=(6*(math.sum)(...sequence))),(error=(math.abs)(((math.Pi??null)-estimate))),(rootThreeError=error),({Angle:__Oak_String(`âˆš3`),[__Oak_String(`Estimate for Ï€`)]:estimate,Error:error,[__Oak_String(`% Error`)]:__as_oak_string(string((math.round)(((error/estimate)*100),6))+__Oak_String(`%`))})))()]),(EarthCircumference=((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`Kilometers`))?40075.017:24901.461)((units.value??null))),(nb.label)((fmt.format)(__Oak_String(`If we measured the circumference of the Earth using these estimates of Ï€,
        the estimate based on angle = 1 would be off by **{{0}}{{2}}**, while the estimate
        based on angle = âˆš3 would be off by only **{{1}}{{2}}**.`),(math.round)((EarthCircumference*oneError),3),(math.round)((EarthCircumference*rootThreeError),3),((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`Kilometers`))?__Oak_String(`km`):__Oak_String(` miles`))((units.value??null))))))()},(nb.register)(display),(nb.display)()))()},panel_17=function panel_17(){return ((counter,display,nb)=>((nb=Notebook(17)),(counter=(nb.button)(__Oak_String(`Count up!`))),display=function display(){return ((nb.label)((counter.count??null),__Oak_String(`clicks,`),__Oak_String(`last clicked`),(datetime.format)(int((counter.value??null)))),(nb.label)((str.join)((std.map)((std.range)((counter.count??null)),function _(){return __Oak_String(`ðŸŒˆ`)}),__Oak_String(` `))))},(nb.register)(display),(nb.display)()))()},panel_20=function panel_20(){return ((display,light,nb)=>((nb=Notebook(20)),(light=(nb.checkbox)(__Oak_String(`Light switch`))),display=function display(){return ((nb.label)(((__oak_cond)=>__oak_eq(__oak_cond,true)?__Oak_String(`ðŸ’¡ Lights on!`):__Oak_String(`ðŸ”¦ Light off...`))((light.checked??null))))},(nb.register)(display),(nb.display)()))()},panel_23=function panel_23(){return ((display,first,nb,second)=>((nb=Notebook(23)),(first=(nb.number)(__Oak_String(`First number`),2,0,10,1)),(second=(nb.number)(__Oak_String(`Second number`),3,0,10,1)),display=function display(){return ((nb.label)((fmt.format)(__Oak_String(`{{0}} Ã— {{1}} = {{2}}`),(first.value??null),(second.value??null),((first.value??null)*(second.value??null)))))},(nb.register)(display),(nb.display)()))()},panel_26=function panel_26(){return ((display,nb,rotation)=>((nb=Notebook(26)),(rotation=(nb.scrubbable)(30,0,720,1,[__Oak_String(`Rotate me by `),__Oak_String(`Âº`)])),display=function display(){return ((nb.html)((fmt.format)(__Oak_String(`<div style="
            transform: rotate({{0}}deg);
            height: 100px;
            width: 100px;
            display: flex;
            align-items: center;
            justify-content: center">HELLO</div>`),(rotation.value??null))))},(nb.register)(display),(nb.display)()))()},panel_29=function panel_29(){return ((display,input,nb)=>((nb=Notebook(29)),(input=(nb.text)(__Oak_String(`Tell me a sentence`),__Oak_String(`The quick brown fox jumped over the lazy dog`))),display=function display(){return ((wordCount)=>((wordCount=len((std.filter)((str.split)((input.value??null),__Oak_String(` `)),function _(s=null){return !__oak_eq(s,__Oak_String(``))}))),(nb.label)(__Oak_String(`There are`),wordCount,__Oak_String(`words in this sentence!`))))()},(nb.register)(display),(nb.display)()))()},panel_32=function panel_32(){return ((display,nb,paragraph)=>((nb=Notebook(32)),(paragraph=(nb.prose)(__Oak_String(`Story`),__Oak_String(`All human beings are born free and equal in dignity and rights. They are endowed with reason and conscience and should act towards one another in a spirit of brotherhood.`))),display=function display(){return ((uniqWords,words)=>((words=(std.compact)((str.split)((str.lower)((std.filter)((paragraph.value??null),function _(c=null){return (__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(` `))))((str.letter__oak_qm)(c))})),__Oak_String(` `)))),(uniqWords=(std.uniq)((sort.sort)(words))),(nb.table)((std.take)((std.reverse)((sort.sort)((std.map)(uniqWords,function _(word=null){return ({word,count:len((std.filter)(words,function _(w=null){return __oak_eq(w,word)}))})}),Symbol.for('count'))),10))))()},(nb.register)(display),(nb.display)()))()},panel_35=function panel_35(){return ((color,display,nb)=>((nb=Notebook(35)),(color=(nb.select)(__Oak_String(`Color`),[__Oak_String(`Red`),__Oak_String(`Blue`),__Oak_String(`Green`),__Oak_String(`Yellow`)])),display=function display(){return ((nb.html)((fmt.format)(__Oak_String(`<div style="height:100px;width:100px;border-radius:4px;background:{{ 0 }}"></div>`),(str.lower)((color.value??null)))))},(nb.register)(display),(nb.display)()))()},panel_40=function panel_40(){return ((display,nb)=>((nb=Notebook(40)),display=function display(){return ((nb.label)(__Oak_String(`Hello, World!`)))},(nb.register)(display),(nb.display)()))()},panel_42=function panel_42(){return ((display,nb)=>((nb=Notebook(42)),display=function display(){return ((nb.table)([1,2,3,4,5]))},(nb.register)(display),(nb.display)()))()},panel_43=function panel_43(){return ((base,display,maxExp,nb)=>((nb=Notebook(43)),(base=(nb.scrubbable)(2,1,20,1,[__Oak_String(`Base: `),__Oak_String(``)])),(maxExp=(nb.scrubbable)(5,1,25,1,[__Oak_String(`Show up to: `),__Oak_String(``)])),display=function display(){return ((nb.table)((std.map)((std.range)(0,__as_oak_string((maxExp.value??null)+1),1),function _(exp=null){return (({power:exp,value:pow((base.value??null),exp)}))})))},(nb.register)(display),(nb.display)()))()},panel_46=function panel_46(){return ((b,display,g,nb,r)=>((nb=Notebook(46)),(r=(nb.scrubbable)(180,0,255,1,[__Oak_String(`Red: `),__Oak_String(``)])),(g=(nb.scrubbable)(190,0,255,1,[__Oak_String(`Green: `),__Oak_String(``)])),(b=(nb.scrubbable)(216,0,255,1,[__Oak_String(`Blue: `),__Oak_String(``)])),display=function display(){return ((nb.html)((fmt.format)(__Oak_String(`<div style="height:100px;width:100px;border-radius:4px;background:rgb({{0}},{{1}},{{2}})"></div>`),(r.value??null),(g.value??null),(b.value??null))))},(nb.register)(display),(nb.display)()))()},panel_8(),panel_17(),panel_20(),panel_23(),panel_26(),panel_29(),panel_32(),panel_35(),panel_40(),panel_42(),panel_43(),panel_46(),({Notebook,datetime,debug,fmt,math,md,panel_17,panel_20,panel_23,panel_26,panel_29,panel_32,panel_35,panel_40,panel_42,panel_43,panel_46,panel_8,sort,std,str})))()}),__oak_modularize(__Oak_String(`datetime`),function _(){return ((DaysBeforeMonth,DaysFrom1To1970,DaysPer100Years,DaysPer400Years,DaysPer4Years,LeapDay,SecondsPerDay,ZeroYear,_describeClock,_describeDate,_parseTZOffset,__oak_js_default,describe,endsWith__oak_qm,fmtFormat,format,leap__oak_qm,map,merge,padEnd,padStart,parse,slice,split,strContains__oak_qm,strIndexOf,take,timestamp)=>(({__oak_js_default,map,take,slice,merge}=__oak_module_import(__Oak_String(`std`))),({endsWith__oak_qm,contains__oak_qm:strContains__oak_qm=null,indexOf:strIndexOf=null,padStart,padEnd,split}=__oak_module_import(__Oak_String(`str`))),({format:fmtFormat=null}=__oak_module_import(__Oak_String(`fmt`))),(LeapDay=__as_oak_string(31+28)),(SecondsPerDay=86400),(DaysPer4Years=__as_oak_string((365*4)+1)),(DaysPer100Years=((25*DaysPer4Years)-1)),(DaysPer400Years=__as_oak_string((DaysPer100Years*4)+1)),(ZeroYear=1),(DaysFrom1To1970=(((DaysPer400Years*5)-(365*31))-8)),(DaysBeforeMonth=[__Oak_Empty,0,31,__as_oak_string(31+28),__as_oak_string(__as_oak_string(31+28)+31),__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30)+31),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30)+31)+31),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30)+31)+31)+30),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30)+31)+31)+30)+31),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30)+31)+31)+30)+31)+30),__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(31+28)+31)+30)+31)+30)+31)+31)+30)+31)+30)+31)]),leap__oak_qm=function leap__oak_qm(year=null){return (__oak_left=>__oak_left===false?false:__oak_and(__oak_left,((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq((year%400),0)))(!__oak_eq((year%100),0)))))(__oak_eq((year%4),0))},_describeDate=function _describeDate(t=null){return ((d,day,leapYear__oak_qm,month,n,n100,n4,n400,year)=>((d=__as_oak_string(int((((t-(t%SecondsPerDay)))/SecondsPerDay))+DaysFrom1To1970)),((__oak_cond)=>__oak_eq(__oak_cond,true)?(d=(d-1)):null)((__oak_left=>__oak_left===false?false:__oak_and(__oak_left,!__oak_eq((t%86400),0)))((t<0))),(n400=int((d/DaysPer400Years))),(d=(d-(DaysPer400Years*n400))),(n100=int((d/DaysPer100Years))),(n100=(n100-int((n100/4)))),(d=(d-(DaysPer100Years*n100))),(n4=int((d/DaysPer4Years))),(d=(d-(DaysPer4Years*n4))),(n=int((d/365))),(n=(n-int((n/4)))),(d=(d-(365*n))),(year=__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(ZeroYear+(400*n400))+(100*n100))+(4*n4))+n)),(month=0),(day=d),(leapYear__oak_qm=leap__oak_qm(year)),((__oak_cond)=>__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,__oak_eq(day,LeapDay)))(leapYear__oak_qm))?((month=2),(day=29)):((subMonth)=>(((__oak_cond)=>__oak_eq(__oak_cond,true)?(day=(day-1)):null)((__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(day>LeapDay)))(leapYear__oak_qm)),subMonth=function subMonth(m=null){return ((__oak_trampolined_subMonth)=>((__oak_trampolined_subMonth=function _(m=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?m:__oak_trampoline(__oak_trampolined_subMonth,__as_oak_string(m+1)))((day<__oak_acc(DaysBeforeMonth,__oak_obj_key((__as_oak_string(m+1))))))}),__oak_resolve_trampoline(__oak_trampolined_subMonth,m)))()},(month=subMonth(1)),(day=__as_oak_string((day-__oak_acc(DaysBeforeMonth,__oak_obj_key((month))))+1))))())(true),({year,month,day})))()},_describeClock=function _describeClock(t=null){return ((hour,minute,rem)=>((rem=(t%SecondsPerDay)),((__oak_cond)=>__oak_eq(__oak_cond,true)?(rem=__as_oak_string(rem+SecondsPerDay)):null)((rem<0)),(hour=int((rem/3600))),(rem=(rem%3600)),(minute=int((rem/60))),({hour,minute,second:(rem%60)})))()},describe=function describe(t=null){return merge(_describeDate(t),_describeClock(t))},timestamp=function timestamp(desc=null){return ((day,daysFrom1,daysFrom1970,daysYearToDate,hour,leapYear__oak_qm,minute,month,n100,n4,n400,second,year)=>(({year,month,day,hour,minute,second}=desc),(leapYear__oak_qm=leap__oak_qm(year)),(year=(year-ZeroYear)),(n400=int((year/400))),(year=(year%400)),(n100=int((year/100))),(year=(year%100)),(n4=int((year/4))),(year=(year%4)),(daysYearToDate=((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_cond)=>__oak_eq(__oak_cond,__oak_eq(month,1))?(__as_oak_string(__oak_acc(DaysBeforeMonth,__oak_obj_key((month)))+day)-1):__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(day<29)))(__oak_eq(month,2)))?(__as_oak_string(__oak_acc(DaysBeforeMonth,__oak_obj_key((month)))+day)-1):__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,__oak_eq(day,29)))(__oak_eq(month,2)))?59:__as_oak_string(__oak_acc(DaysBeforeMonth,__oak_obj_key((month)))+day))(true):(__as_oak_string(__oak_acc(DaysBeforeMonth,__oak_obj_key((month)))+day)-1))(leapYear__oak_qm)),(daysFrom1=__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string((DaysPer400Years*n400)+(DaysPer100Years*n100))+(DaysPer4Years*n4))+(365*year))+daysYearToDate)),(daysFrom1970=(daysFrom1-DaysFrom1To1970)),__as_oak_string(__as_oak_string(__as_oak_string((daysFrom1970*SecondsPerDay)+(3600*hour))+(60*minute))+second)))()},format=function format(t=null,tzOffset=null){return ((day,hour,minute,month,second,year)=>((tzOffset=__oak_js_default(tzOffset,0)),({year,month,day,hour,minute,second}=describe(__as_oak_string(t+(tzOffset*60)))),fmtFormat(__Oak_String(`{{0}}-{{1}}-{{2}}T{{3}}:{{4}}:{{5}}{{6}}`),((__oak_cond)=>__oak_eq(__oak_cond,(year>9999))?padStart(string(year),6,__Oak_String(`0`)):__oak_eq(__oak_cond,(year<0))?__oak_push(__Oak_String(`-`),padStart(string(-year),6,__Oak_String(`0`))):padStart(string(year),4,__Oak_String(`0`)))(true),padStart(string(month),2,__Oak_String(`0`)),padStart(string(day),2,__Oak_String(`0`)),padStart(string(hour),2,__Oak_String(`0`)),padStart(string(minute),2,__Oak_String(`0`)),padStart(string(second),2,__Oak_String(`0`)),((__oak_cond)=>__oak_eq(__oak_cond,__oak_eq(tzOffset,0))?__Oak_String(`Z`):__oak_eq(__oak_cond,(tzOffset>0))?__oak_push(__Oak_String(`+`),fmtFormat(__Oak_String(`{{0}}:{{1}}`),padStart(string(int((tzOffset/60))),2,__Oak_String(`0`)),padStart(string((tzOffset%60)),2,__Oak_String(`0`)))):__oak_push(__Oak_String(`-`),fmtFormat(__Oak_String(`{{0}}:{{1}}`),padStart(string(int((-tzOffset/60))),2,__Oak_String(`0`)),padStart(string((-tzOffset%60)),2,__Oak_String(`0`)))))(true))))()},_parseTZOffset=function _parseTZOffset(offsetString=null){let hh;let mm;return ((__oak_cond)=>__oak_eq(__oak_cond,[])?null:__oak_eq(__oak_cond,[__Oak_Empty])?null:__oak_eq(__oak_cond,[null,__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,null])?null:__as_oak_string((hh*60)+mm))(([hh=null,mm=null]=map(split(offsetString,__Oak_String(`:`)),int)))},parse=function parse(s=null){let clock;let date;let day;let hour;let minute;let month;let second;let year;return ((__oak_cond)=>__oak_eq(__oak_cond,[])?null:__oak_eq(__oak_cond,[__Oak_Empty])?null:__oak_eq(__oak_cond,[null,__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,null])?null:((__oak_cond)=>__oak_eq(__oak_cond,[])?null:__oak_eq(__oak_cond,[__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,__Oak_Empty])?null:__oak_eq(__oak_cond,[null,__Oak_Empty,__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,null,__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,__Oak_Empty,null])?null:((__oak_cond)=>__oak_eq(__oak_cond,[])?null:__oak_eq(__oak_cond,[__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,__Oak_Empty])?null:__oak_eq(__oak_cond,[null,__Oak_Empty,__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,null,__Oak_Empty])?null:__oak_eq(__oak_cond,[__Oak_Empty,__Oak_Empty,null])?null:((maybeMillis,parsed,tzOffset)=>(([__oak_empty_assgn_tgt=null,maybeMillis=null]=map(map(split(clock,__Oak_String(`.`)),function _(s=null){return take(s,3)}),int)),(tzOffset=((__oak_cond)=>__oak_eq(__oak_cond,strContains__oak_qm(clock,__Oak_String(`+`)))?_parseTZOffset(slice(clock,__as_oak_string(strIndexOf(clock,__Oak_String(`+`))+1))):__oak_eq(__oak_cond,strContains__oak_qm(clock,__Oak_String(`-`)))?((__oak_cond)=>__oak_eq(__oak_cond,null)?null:-parsed)((parsed=_parseTZOffset(slice(clock,__as_oak_string(strIndexOf(clock,__Oak_String(`-`))+1))))):0)(true)),((__oak_cond)=>__oak_eq(__oak_cond,true)?({year,month,day,hour,minute,second,millis:__oak_js_default(maybeMillis,0),tzOffset}):null)(!__oak_eq(tzOffset,null))))())(([hour=null,minute=null,second=null]=map(split(take(clock,8),__Oak_String(`:`)),int))))(([year=null,month=null,day=null]=map(split(date,__Oak_String(`-`)),int))))(([date=null,clock=null]=split(s,__Oak_String(`T`))))},({DaysBeforeMonth,DaysFrom1To1970,DaysPer100Years,DaysPer400Years,DaysPer4Years,LeapDay,SecondsPerDay,ZeroYear,_describeClock,_describeDate,_parseTZOffset,__oak_js_default,describe,endsWith__oak_qm,fmtFormat,format,leap__oak_qm,map,merge,padEnd,padStart,parse,slice,split,strContains__oak_qm,strIndexOf,take,timestamp})))()}),__oak_modularize(__Oak_String(`debug`),function _(){return ((_numeral__oak_qm,_primitive__oak_qm,_validIdent__oak_qm,__oak_js_default,digit__oak_qm,entries,every,format,inspect,join,letter__oak_qm,map,padStart,println,reduce,some,sort__oak_exclam,stdPrintln,toHex,values)=>(({println:stdPrintln=null,__oak_js_default,toHex,map,some,every,values,reduce,entries}=__oak_module_import(__Oak_String(`std`))),({letter__oak_qm,digit__oak_qm,join,padStart}=__oak_module_import(__Oak_String(`str`))),({sort__oak_exclam}=__oak_module_import(__Oak_String(`sort`))),({format}=__oak_module_import(__Oak_String(`fmt`))),_validIdent__oak_qm=function _validIdent__oak_qm(s=null){return every(s,function _(c=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?(__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(`!`))))((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(`?`))))((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(`_`))))(letter__oak_qm(c)))):(__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(`!`))))((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(`?`))))((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,__oak_eq(c,__Oak_String(`_`))))((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,digit__oak_qm(c)))(letter__oak_qm(c))))))(i)})},_numeral__oak_qm=function _numeral__oak_qm(s=null){return every(s,digit__oak_qm)},_primitive__oak_qm=function _primitive__oak_qm(x=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('null'))?true:__oak_eq(__oak_cond,Symbol.for('empty'))?true:__oak_eq(__oak_cond,Symbol.for('bool'))?true:__oak_eq(__oak_cond,Symbol.for('int'))?true:__oak_eq(__oak_cond,Symbol.for('float'))?true:__oak_eq(__oak_cond,Symbol.for('string'))?true:__oak_eq(__oak_cond,Symbol.for('atom'))?true:__oak_eq(__oak_cond,Symbol.for('function'))?true:false)(type(x))},inspect=function inspect(x=null,options=null){return ((depth,indentUnit,inspectAbbreviated,inspectAny,inspectLine,inspectMulti,inspectObjectKey,maxLine,maxList,maxObject)=>(({indent:indentUnit=null,depth,maxLine,maxList,maxObject}=__oak_js_default(options,({}))),(indentUnit=__oak_js_default(indentUnit,__Oak_String(`  `))),(depth=__oak_js_default(depth,-1)),(maxLine=__oak_js_default(maxLine,80)),(maxList=__oak_js_default(maxList,16)),(maxObject=__oak_js_default(maxObject,3)),inspectObjectKey=function inspectObjectKey(key=null){return ((__oak_cond)=>__oak_eq(__oak_cond,_validIdent__oak_qm(key))?key:__oak_eq(__oak_cond,_numeral__oak_qm(key))?key:inspectLine(key,-1))(true)},inspectAbbreviated=function inspectAbbreviated(x=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('list'))?format(__Oak_String(`[ {{0}} items... ]`),len(x)):__oak_eq(__oak_cond,Symbol.for('object'))?format(__Oak_String(`{ {{0}} entries... }`),len(x)):null)(type(x))},inspectLine=function inspectLine(x=null,depth=null){let payload;return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('null'))?string(x):__oak_eq(__oak_cond,Symbol.for('empty'))?string(x):__oak_eq(__oak_cond,Symbol.for('bool'))?string(x):__oak_eq(__oak_cond,Symbol.for('int'))?string(x):__oak_eq(__oak_cond,Symbol.for('float'))?string(x):__oak_eq(__oak_cond,Symbol.for('string'))?__as_oak_string(__as_oak_string(__Oak_String(`'`)+(map(x,function _(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`\\`))?__Oak_String(`\\\\`):__oak_eq(__oak_cond,__Oak_String(`'`))?__Oak_String(`\\'`):__oak_eq(__oak_cond,__Oak_String(`
`))?__Oak_String(`\\n`):__oak_eq(__oak_cond,__Oak_String(``))?__Oak_String(`\\r`):__oak_eq(__oak_cond,__Oak_String(``))?__Oak_String(`\\f`):__oak_eq(__oak_cond,__Oak_String(`	`))?__Oak_String(`\\t`):((__oak_cond)=>__oak_eq(__oak_cond,(codepoint(c)<32))?__oak_push(__Oak_String(`\\x`),padStart(toHex(codepoint(c)),2,__Oak_String(`0`))):__oak_eq(__oak_cond,(codepoint(c)>126))?__oak_push(__Oak_String(`\\x`),padStart(toHex(codepoint(c)),2,__Oak_String(`0`))):c)(true))(c)})))+__Oak_String(`'`)):__oak_eq(__oak_cond,Symbol.for('atom'))?((__oak_cond)=>__oak_eq(__oak_cond,true)?__as_oak_string(__Oak_String(`:`)+string(payload)):format(__Oak_String(`atom({{0}})`),inspectLine(payload)))(_validIdent__oak_qm((payload=string(x)))):__oak_eq(__oak_cond,Symbol.for('function'))?__Oak_String(`fn { ... }`):__oak_eq(__oak_cond,Symbol.for('list'))?__as_oak_string(__as_oak_string(__Oak_String(`[`)+(join(map(x,function _(y=null){return inspectLine(y,depth)}),__Oak_String(`, `))))+__Oak_String(`]`)):__oak_eq(__oak_cond,Symbol.for('object'))?((__oak_cond)=>__oak_eq(__oak_cond,0)?__Oak_String(`{}`):__as_oak_string(__as_oak_string(__Oak_String(`{ `)+(join(map(sort__oak_exclam(entries(x),0),function _(entry=null){return __as_oak_string(__as_oak_string(inspectObjectKey(__oak_acc(entry,0))+__Oak_String(`: `))+inspectLine(__oak_acc(entry,1),depth))}),__Oak_String(`, `))))+__Oak_String(` }`)))(len(x)):null)(type(x))},inspectMulti=function inspectMulti(x=null,indent=null,depth=null){return ((innerIndent)=>((innerIndent=__as_oak_string(indent+indentUnit)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('list'))?__oak_push(reduce(x,__Oak_String(`[`),function _(lines=null,item=null){return (__oak_push(lines,__as_oak_string(__as_oak_string(__Oak_String(`
`)+innerIndent)+inspectAny(item,innerIndent,depth))))}),__as_oak_string(__as_oak_string(__Oak_String(`
`)+indent)+__Oak_String(`]`))):__oak_eq(__oak_cond,Symbol.for('object'))?__oak_push(reduce(sort__oak_exclam(entries(x),0),__Oak_String(`{`),function _(lines=null,entry=null){return (__oak_push(lines,__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(__Oak_String(`
`)+innerIndent)+inspectObjectKey(__oak_acc(entry,0)))+__Oak_String(`: `))+inspectAny(__oak_acc(entry,1),innerIndent,depth))))}),__as_oak_string(__as_oak_string(__Oak_String(`
`)+indent)+__Oak_String(`}`))):null)(type(x))))()},inspectAny=function inspectAny(x=null,indent=null,depth=null){return ((line,overflows__oak_qm)=>((line=inspectLine(x,(depth-1))),(overflows__oak_qm=(__as_oak_string(len(line)+len(indent))>maxLine)),((__oak_cond)=>__oak_eq(__oak_cond,_primitive__oak_qm(x))?line:__oak_eq(__oak_cond,__oak_eq(depth,0))?inspectAbbreviated(x):__oak_eq(__oak_cond,overflows__oak_qm)?inspectMulti(x,indent,(depth-1)):__oak_eq(__oak_cond,__oak_eq(type(x),Symbol.for('list')))?((__oak_cond)=>__oak_eq(__oak_cond,(len(x)>maxList))?inspectMulti(x,indent,(depth-1)):__oak_eq(__oak_cond,some(x,function _(y=null){return !_primitive__oak_qm(y)}))?inspectMulti(x,indent,(depth-1)):line)(true):__oak_eq(__oak_cond,__oak_eq(type(x),Symbol.for('object')))?((__oak_cond)=>__oak_eq(__oak_cond,(len(x)>maxObject))?inspectMulti(x,indent,(depth-1)):__oak_eq(__oak_cond,some(values(x),function _(y=null){return !_primitive__oak_qm(y)}))?inspectMulti(x,indent,(depth-1)):line)(true):null)(true)))()},inspectAny(x,__Oak_String(``),depth)))()},println=function println(x=null,options=null){return stdPrintln(inspect(x,options))},({_numeral__oak_qm,_primitive__oak_qm,_validIdent__oak_qm,__oak_js_default,digit__oak_qm,entries,every,format,inspect,join,letter__oak_qm,map,padStart,println,reduce,some,sort__oak_exclam,stdPrintln,toHex,values})))()}),__oak_modularize(__Oak_String(`fmt`),function _(){return ((__oak_js_default,format,printf,println)=>(({println,__oak_js_default}=__oak_module_import(__Oak_String(`std`))),format=function format(raw=null,...values){return ((buf,key,sub,value,which)=>((which=0),(key=__Oak_String(``)),(buf=__Oak_String(``)),(value=__oak_js_default(__oak_acc(values,0),({}))),sub=function sub(idx=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(idx=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((c)=>((c=__oak_acc(raw,__oak_obj_key((idx)))),((__oak_cond)=>__oak_eq(__oak_cond,0)?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`{`))?(which=1):__oak_push(buf,c))(c):__oak_eq(__oak_cond,1)?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`{`))?(which=2):(__oak_push(__oak_push(buf,__Oak_String(`{`)),c),(which=0)))(c):__oak_eq(__oak_cond,2)?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`}`))?((index)=>((index=int(key)),__oak_push(buf,string(((__oak_cond)=>__oak_eq(__oak_cond,__oak_eq(key,__Oak_String(``)))?__Oak_String(``):__oak_eq(__oak_cond,__oak_eq(index,null))?__oak_acc(value,__oak_obj_key((key))):__oak_acc(values,__oak_obj_key((index))))(true))),(key=__Oak_String(``)),(which=3)))():__oak_eq(__oak_cond,__Oak_String(` `))?null:__oak_eq(__oak_cond,__Oak_String(`	`))?null:(key=__as_oak_string(key+c)))(c):__oak_eq(__oak_cond,3)?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`}`))?(which=0):null)(c):null)(which),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(idx+1))))():buf)((idx<len(raw)))}),__oak_resolve_trampoline(__oak_trampolined_sub,idx)))()},sub(0)))()},printf=function printf(raw=null,...values){return println(format(raw,...values))},({__oak_js_default,format,printf,println})))()}),__oak_modularize(__Oak_String(`fs`),function _(){return ((ReadBufSize,appendFile,listFiles,listFilesAsync,listFilesSync,readFile,readFileAsync,readFileSync,statFile,statFileAsync,statFileSync,writeFile,writeFileAsyncWithFlag,writeFileSyncWithFlag)=>((ReadBufSize=4096),readFileSync=function readFileSync(path=null){return ((evt)=>((evt=open(path,Symbol.for('readonly'))),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?null:((fd,sub)=>((fd=(evt.fd??null)),sub=function sub(file=null,offset=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(file=null,offset=null){return ((evt)=>((evt=read(fd,offset,ReadBufSize)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?(close(fd),null):((__oak_cond)=>__oak_eq(__oak_cond,ReadBufSize)?__oak_trampoline(__oak_trampolined_sub,__oak_push(file,(evt.data??null)),__as_oak_string(offset+ReadBufSize)):(close(fd),__oak_push(file,(evt.data??null))))(len((evt.data??null))))((evt.type??null))))()}),__oak_resolve_trampoline(__oak_trampolined_sub,file,offset)))()},sub(__Oak_String(``),0)))())((evt.type??null))))()},readFileAsync=function readFileAsync(path=null,withFile=null){return open(path,Symbol.for('readonly'),function _(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?withFile(null):((fd,sub)=>((fd=(evt.fd??null)),sub=function sub(file=null,offset=null){return read(fd,offset,ReadBufSize,function _(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?close(fd,function _(){return (withFile(null))}):((__oak_cond)=>__oak_eq(__oak_cond,ReadBufSize)?sub(__oak_push(file,(evt.data??null)),__as_oak_string(offset+ReadBufSize)):close(fd,function _(){return (withFile(__oak_push(file,(evt.data??null))))}))(len((evt.data??null))))((evt.type??null))})},sub(__Oak_String(``),0)))())((evt.type??null))})},readFile=function readFile(path=null,withFile=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?readFileSync(path):readFileAsync(path,withFile))(withFile)},writeFileSyncWithFlag=function writeFileSyncWithFlag(path=null,file=null,flag=null){return ((evt)=>((evt=open(path,flag)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?null:((fd)=>((fd=(evt.fd??null)),((evt)=>((evt=write(fd,0,file)),close(fd),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?null:true)((evt.type??null))))()))())((evt.type??null))))()},writeFileAsyncWithFlag=function writeFileAsyncWithFlag(path=null,file=null,flag=null,withEnd=null){return open(path,flag,function _(evt=null){let fd;return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?withEnd(null):write((fd=(evt.fd??null)),0,file,function _(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?close(fd,function _(){return (withEnd(null))}):close(fd,function _(){return (withEnd(true))}))((evt.type??null))}))((evt.type??null))})},writeFile=function writeFile(path=null,file=null,withEnd=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?writeFileSyncWithFlag(path,file,Symbol.for('truncate')):writeFileAsyncWithFlag(path,file,Symbol.for('truncate'),withEnd))(withEnd)},appendFile=function appendFile(path=null,file=null,withEnd=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?writeFileSyncWithFlag(path,file,Symbol.for('append')):writeFileAsyncWithFlag(path,file,Symbol.for('append'),withEnd))(withEnd)},statFileSync=function statFileSync(path=null){return ((evt)=>((evt=stat(path)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?null:(evt.data??null))((evt.type??null))))()},statFileAsync=function statFileAsync(path=null,withStat=null){return stat(path,function _(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?withStat(null):withStat((evt.data??null)))((evt.type??null))})},statFile=function statFile(path=null,withStat=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?statFileSync(path):statFileAsync(path,withStat))(withStat)},listFilesSync=function listFilesSync(path=null){return ((evt)=>((evt=ls(path)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?null:(evt.data??null))((evt.type??null))))()},listFilesAsync=function listFilesAsync(path=null,withFiles=null){return ls(path,function _(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?withFiles(null):withFiles((evt.data??null)))((evt.type??null))})},listFiles=function listFiles(path=null,withFiles=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?listFilesSync(path):listFilesAsync(path,withFiles))(withFiles)},({ReadBufSize,appendFile,listFiles,listFilesAsync,listFilesSync,readFile,readFileAsync,readFileSync,statFile,statFileAsync,statFileSync,writeFile,writeFileAsyncWithFlag,writeFileSyncWithFlag})))()}),__oak_modularize(__Oak_String(`http`),function _(){return ((MethodNotAllowed,MimeTypes,NotFound,Router,Server,_encodeChar,_hdr,_hex__oak_qm,checkRange,contains__oak_qm,cut,__oak_js_default,digit__oak_qm,each,filter,fromHex,handleStatic,join,lower,lower__oak_qm,map,mimeForPath,percentDecode,percentEncode,percentEncodeURI,printf,println,readFile,reduce,slice,split,toHex,upper,upper__oak_qm,word__oak_qm)=>(({println,__oak_js_default,toHex,fromHex,slice,map,each,filter,reduce}=__oak_module_import(__Oak_String(`std`))),({checkRange,cut,join,contains__oak_qm,digit__oak_qm,upper__oak_qm,lower__oak_qm,word__oak_qm,upper,lower,split}=__oak_module_import(__Oak_String(`str`))),({readFile}=__oak_module_import(__Oak_String(`fs`))),({printf}=__oak_module_import(__Oak_String(`fmt`))),_encodeChar=function _encodeChar(uri__oak_qm=null){return function _(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,word__oak_qm(c))?c:__oak_eq(__oak_cond,contains__oak_qm(__Oak_String(`-_.!~*'()`),c))?c:__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,contains__oak_qm(__Oak_String(`;,/?:@&=+$#`),c)))(uri__oak_qm))?c:__as_oak_string(__Oak_String(`%`)+upper(toHex(codepoint(c)))))(true)}},percentEncode=function percentEncode(s=null){return map(s,_encodeChar(false))},percentEncodeURI=function percentEncodeURI(s=null){return map(s,_encodeChar(true))},_hex__oak_qm=function _hex__oak_qm(c=null){return (__oak_left=>__oak_left===true?true:__oak_or(__oak_left,((__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(c<=__Oak_String(`f`))))((c>=__Oak_String(`a`))))))((__oak_left=>__oak_left===true?true:__oak_or(__oak_left,((__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(c<=__Oak_String(`F`))))((c>=__Oak_String(`A`))))))(digit__oak_qm(c)))},percentDecode=function percentDecode(s=null){return ((buf,stage)=>((stage=Symbol.for('default')),(buf=null),reduce(s,__Oak_String(``),function _(decoded=null,curr=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('default'))?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`+`))?__oak_push(decoded,__Oak_String(` `)):__oak_eq(__oak_cond,__Oak_String(`%`))?((stage=Symbol.for('sawPercent')),decoded):__oak_push(decoded,curr))(curr):__oak_eq(__oak_cond,Symbol.for('sawPercent'))?((__oak_cond)=>__oak_eq(__oak_cond,false)?((stage=Symbol.for('default')),__oak_push(__oak_push(decoded,__Oak_String(`%`)),curr)):((stage=Symbol.for('sawFirstHex')),(buf=curr),decoded))(_hex__oak_qm(curr)):((last)=>((last=buf),(stage=Symbol.for('default')),(buf=null),((__oak_cond)=>__oak_eq(__oak_cond,false)?__oak_push(__oak_push(__oak_push(decoded,__Oak_String(`%`)),last),curr):__oak_push(decoded,char(fromHex(lower(__oak_push(last,curr))))))(_hex__oak_qm(curr))))())(stage)})))()},Router=function Router(){return ((add,__oak_js_catch,match,matchPath,self,splitPath)=>((self=[]),add=function add(pattern=null,handler=null){return __oak_push(self,[pattern,handler])},__oak_js_catch=function __oak_js_catch(handler=null){return add(__Oak_String(``),handler)},splitPath=function splitPath(url=null){return filter(split(url,__Oak_String(`/`)),function _(s=null){return !__oak_eq(s,__Oak_String(``))})},matchPath=function matchPath(pattern=null,path=null){return ((actual,desired,findMatchingParams,params,query)=>((params=({})),([path=null,query=null]=cut(path,__Oak_String(`?`))),((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(``))?null:each(map(split(query,__Oak_String(`&`)),function _(pair=null){return cut(pair,__Oak_String(`=`))}),function _(pair=null){return ((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((__oak_acc(pair,0)),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((__oak_acc(pair,0)))]):(__oak_assgn_tgt[__oak_obj_key((__oak_acc(pair,0)))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(params),percentDecode(__oak_acc(pair,1)))}))(query),(desired=splitPath(pattern)),(actual=splitPath(path)),findMatchingParams=function findMatchingParams(i=null){return ((__oak_trampolined_findMatchingParams)=>((__oak_trampolined_findMatchingParams=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(desired))?((__oak_cond)=>__oak_eq(__oak_cond,len(actual))?params:null)(i):((actualPart,desiredPart)=>((desiredPart=__oak_js_default(__oak_acc(desired,__oak_obj_key((i))),__Oak_String(``))),(actualPart=__oak_js_default(__oak_acc(actual,__oak_obj_key((i))),__Oak_String(``))),((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`:`))?(((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((slice(desiredPart,1)),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((slice(desiredPart,1)))]):(__oak_assgn_tgt[__oak_obj_key((slice(desiredPart,1)))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(params),percentDecode(actualPart)),__oak_trampoline(__oak_trampolined_findMatchingParams,__as_oak_string(i+1))):__oak_eq(__oak_cond,__Oak_String(`*`))?(((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((slice(desiredPart,1)),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((slice(desiredPart,1)))]):(__oak_assgn_tgt[__oak_obj_key((slice(desiredPart,1)))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(params),join(map(slice(actual,i),percentDecode),__Oak_String(`/`)))):((__oak_cond)=>__oak_eq(__oak_cond,actualPart)?__oak_trampoline(__oak_trampolined_findMatchingParams,__as_oak_string(i+1)):null)(desiredPart))(__oak_acc(desiredPart,0))))())(i)}),__oak_resolve_trampoline(__oak_trampolined_findMatchingParams,i)))()},((__oak_cond)=>__oak_eq(__oak_cond,[__Oak_Empty,__Oak_String(``)])?params:__oak_eq(__oak_cond,[true,__Oak_Empty])?findMatchingParams(0):null)([(len(desired)<=len(actual)),pattern])))()},match=function match(path=null){return ((sub)=>(sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(self))?function _(req=null){return (req.end)(({status:200,headers:({}),body:__Oak_String(`dropped route. you should never see this in production`)}))}:((handler,pattern,result)=>(([pattern=null,handler=null]=__oak_acc(self,__oak_obj_key((i)))),((__oak_cond)=>__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)):handler(result))((result=matchPath(pattern,path)))))())(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},({add,__oak_js_catch,match})))()},(MimeTypes=({blob:__Oak_String(`application/octet-stream`),html:__Oak_String(`text/html; charset=utf-8`),txt:__Oak_String(`text/plain; charset=utf-8`),md:__Oak_String(`text/plain; charset=utf-8`),css:__Oak_String(`text/css; charset=utf-8`),js:__Oak_String(`application/javascript; charset=utf-8`),json:__Oak_String(`application/json; charset=utf-8`),ink:__Oak_String(`text/plain; charset=utf-8`),oak:__Oak_String(`text/plain; charset=utf-8`),jpg:__Oak_String(`image/jpeg`),jpeg:__Oak_String(`image/jpeg`),png:__Oak_String(`image/png`),gif:__Oak_String(`image/gif`),svg:__Oak_String(`image/svg+xml`),webp:__Oak_String(`image/webp`),pdf:__Oak_String(`application/pdf`),zip:__Oak_String(`application/zip`)})),mimeForPath=function mimeForPath(path=null){return ((ending,parts)=>((parts=split(path,__Oak_String(`.`))),(ending=__oak_acc(parts,__oak_obj_key(((len(parts)-1))))),__oak_js_default(__oak_acc(MimeTypes,__oak_obj_key((ending))),(MimeTypes.blob??null))))()},(NotFound=({status:404,body:__Oak_String(`file not found`)})),(MethodNotAllowed=({status:405,body:__Oak_String(`method not allowed`)})),_hdr=function _hdr(attrs=null){return ((base)=>((base=({[__Oak_String(`X-Served-By`)]:__Oak_String(`oak/libhttp`),[__Oak_String(`Content-Type`)]:__Oak_String(`text/plain`)})),each(keys(attrs),function _(k=null){return ((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((k),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((k))]):(__oak_assgn_tgt[__oak_obj_key((k))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(base),__oak_acc(attrs,__oak_obj_key((k))))}),base))()},Server=function Server(){return ((router,start)=>((router=Router()),start=function start(port=null){return ((router.__oak_js_catch)(function _(params=null){return function _(req=null,end=null){return end(({status:404,body:__Oak_String(`service not found`)}))}}),listen(__as_oak_string(__Oak_String(`0.0.0.0:`)+string(port)),function _(evt=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?println(__Oak_String(`server start error:`),(evt.error??null)):((method,url)=>(({method,url}=(evt.req??null)),printf(__Oak_String(`{{ 0 }}: {{ 1 }}`),method,url),(router.match)(url)((evt.req??null),function _(resp=null){return (((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(headers,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.headers):(__oak_assgn_tgt.headers)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(resp),_hdr(__oak_js_default((resp.headers??null),({})))),(evt.end)(resp))})))())((evt.type??null))}))},({route:(router.add??null),start})))()},handleStatic=function handleStatic(path=null){return function _(req=null,end=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`GET`))?readFile(__as_oak_string(__Oak_String(`./`)+path),function _(file=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?end(NotFound):end(({status:200,headers:({[__Oak_String(`Content-Type`)]:mimeForPath(path)}),body:file})))(file)}):end(MethodNotAllowed))((req.method??null))}},({MethodNotAllowed,MimeTypes,NotFound,Router,Server,_encodeChar,_hdr,_hex__oak_qm,checkRange,contains__oak_qm,cut,__oak_js_default,digit__oak_qm,each,filter,fromHex,handleStatic,join,lower,lower__oak_qm,map,mimeForPath,percentDecode,percentEncode,percentEncodeURI,printf,println,readFile,reduce,slice,split,toHex,upper,upper__oak_qm,word__oak_qm})))()}),__oak_modularize(__Oak_String(`math`),function _(){return ((E,Pi,abs,bearing,clamp,__oak_js_default,hypot,map,max,mean,median,min,orient,prod,reduce,round,scale,sign,sort,sqrt,stddev,sum)=>(({__oak_js_default,map,reduce}=__oak_module_import(__Oak_String(`std`))),({sort}=__oak_module_import(__Oak_String(`sort`))),(Pi=3.141592653589793),(E=2.718281828459045),sign=function sign(n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?1:-1)((n>=0))},abs=function abs(n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?n:-n)((n>=0))},sqrt=function sqrt(n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?pow(n,0.5):null)((n>=0))},hypot=function hypot(x0=null,y0=null,x1=null,y1=null){return (((__oak_cond)=>__oak_eq(__oak_cond,true)?(x1=(y1=0)):null)((__oak_left=>__oak_left===false?false:__oak_and(__oak_left,__oak_eq(y1,null)))(__oak_eq(x1,null))),sqrt(__as_oak_string((((x0-x1))*((x0-x1)))+(((y0-y1))*((y0-y1))))))},scale=function scale(x=null,a=null,b=null,c=null,d=null){return ((normed)=>((normed=(((x-a))/((b-a)))),((__oak_cond)=>__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,__oak_eq(d,null)))(__oak_eq(c,null)))?normed:__as_oak_string((((d-c))*normed)+c))(true)))()},bearing=function bearing(x=null,y=null,d=null,t=null){return [__as_oak_string(x+(d*cos(t))),__as_oak_string(y+(d*sin(t)))]},orient=function orient(x0=null,y0=null,x1=null,y1=null){return ((x,y)=>(([x=null,y=null]=((__oak_cond)=>__oak_eq(__oak_cond,true)?[x0,y0]:[(x1-x0),(y1-y0)])((__oak_left=>__oak_left===false?false:__oak_and(__oak_left,__oak_eq(y1,null)))(__oak_eq(x1,null)))),((__oak_cond)=>__oak_eq(__oak_cond,(x>0))?(2*atan((y/(__as_oak_string(hypot(x,y)+x))))):__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,!__oak_eq(y,0)))((x<=0)))?(2*atan((((hypot(x,y)-x))/y))):__oak_eq(__oak_cond,(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,__oak_eq(y,0)))((x<0)))?Pi:null)(true)))()},sum=function sum(...xs){return reduce(xs,0,function _(a=null,b=null){return __as_oak_string(a+b)})},prod=function prod(...xs){return reduce(xs,1,function _(a=null,b=null){return (a*b)})},min=function min(...xs){return reduce(xs,__oak_acc(xs,0),function _(acc=null,n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?n:acc)((n<acc))})},max=function max(...xs){return reduce(xs,__oak_acc(xs,0),function _(acc=null,n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?n:acc)((n>acc))})},clamp=function clamp(x=null,a=null,b=null){return ((__oak_cond)=>__oak_eq(__oak_cond,(x<a))?a:__oak_eq(__oak_cond,(x>b))?b:x)(true)},mean=function mean(xs=null){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?null:(sum(...xs)/len(xs)))(len(xs))},median=function median(xs=null){return ((count,half)=>((xs=sort(xs)),(count=len(xs)),(half=int((count/2))),((__oak_cond)=>__oak_eq(__oak_cond,count)?null:__oak_eq(__oak_cond,(count%2))?((__as_oak_string(__oak_acc(xs,__oak_obj_key(((half-1))))+__oak_acc(xs,__oak_obj_key((half)))))/2):__oak_acc(xs,__oak_obj_key((half))))(0)))()},stddev=function stddev(xs=null){let xmean;return ((__oak_cond)=>__oak_eq(__oak_cond,true)?(sqrt(mean(map(xs,function _(x=null){return pow((xmean-x),2)})))):null)(!__oak_eq(null,(xmean=mean(xs))))},round=function round(n=null,decimals=null){return ((decimals=__oak_js_default(int(decimals),0)),((__oak_cond)=>__oak_eq(__oak_cond,true)?n:((order)=>((order=pow(10,decimals)),((__oak_cond)=>__oak_eq(__oak_cond,true)?(int(__as_oak_string((n*order)+0.5))/order):(-int(__as_oak_string((-n*order)+0.5))/order))((n>=0))))())((decimals<0)))},({E,Pi,abs,bearing,clamp,__oak_js_default,hypot,map,max,mean,median,min,orient,prod,reduce,round,scale,sign,sort,sqrt,stddev,sum})))()}),__oak_modularize(__Oak_String(`md`),function _(){return ((Reader,append,compile,compileNode,digit__oak_qm,each,endsWith__oak_qm,every,filter,format,indexOf,join,letter__oak_qm,lineNodeType,listItemLine__oak_qm,lower,map,oListItemLine__oak_qm,parse,parseBlockQuote,parseCodeBlock,parseDoc,parseHeader,parseList,parseParagraph,parseRawHTML,parseText,percentDecode,reduce,replace,sanitizeAttr,sanitizeURL,slice,space__oak_qm,split,startsWith__oak_qm,take,tokenizeText,transform,trimOListGetLevel,trimStart,trimUListGetLevel,uListItemLine__oak_qm,unifyTextNodes,uword__oak_qm,word__oak_qm,wrap)=>(({slice,map,each,take,filter,reduce,every,append}=__oak_module_import(__Oak_String(`std`))),({digit__oak_qm,letter__oak_qm,space__oak_qm,word__oak_qm,lower,indexOf,startsWith__oak_qm,endsWith__oak_qm,trimStart,replace,join,split}=__oak_module_import(__Oak_String(`str`))),({format}=__oak_module_import(__Oak_String(`fmt`))),({percentDecode}=__oak_module_import(__Oak_String(`http`))),Reader=function Reader(s=null){return ((back,expect__oak_qm,i,itemIndex,last,next,peek,readUntil,readUntilEnd,readUntilMatchingDelim,readUntilPrefix)=>((i=0),peek=function peek(){return __oak_acc(s,__oak_obj_key((i)))},last=function last(){return __oak_acc(s,__oak_obj_key((__as_oak_string(i+1))))},back=function back(){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?0:(i=(i-1)))(i)},next=function next(){return ((__oak_cond)=>__oak_eq(__oak_cond,len(s))?null:((c)=>((c=__oak_acc(s,__oak_obj_key((i)))),(i=__as_oak_string(i+1)),c))())(i)},expect__oak_qm=function expect__oak_qm(prefix=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((i=__as_oak_string(i+len(prefix))),true):false)(startsWith__oak_qm(slice(s,i),prefix))},itemIndex=function itemIndex(list=null,it=null){return ((sub)=>(sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_cond)=>__oak_eq(__oak_cond,it)?i:__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)))(__oak_acc(list,__oak_obj_key((i)))):-1)((i<len(list)))}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},readUntil=function readUntil(c=null){let index;return ((__oak_cond)=>__oak_eq(__oak_cond,-1)?null:((substr)=>((substr=slice(s,i,__as_oak_string(i+index))),(i=__as_oak_string(i+index)),substr))())((index=itemIndex(slice(s,i),c)))},readUntilPrefix=function readUntilPrefix(prefix=null){return ((sub)=>(sub=function sub(index=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(index=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((part)=>(((__oak_cond)=>__oak_eq(__oak_cond,prefix)?((substr)=>((substr=slice(s,i,index)),(i=index),substr))():__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)))((part=slice(s,index,__as_oak_string(index+len(prefix)))))))():null)((__as_oak_string(index+len(prefix))<=len(s)))}),__oak_resolve_trampoline(__oak_trampolined_sub,index)))()},sub(i)))()},readUntilEnd=function readUntilEnd(){return ((substr)=>((substr=slice(s,i)),(i=len(s)),substr))()},readUntilMatchingDelim=function readUntilMatchingDelim(left=null){return ((matchingDelimIdx,right,sub)=>((right=((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`[`))?__Oak_String(`]`):__oak_eq(__oak_cond,__Oak_String(`(`))?__Oak_String(`)`):null)(left)),sub=function sub(index=null,stack=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(index=null,stack=null){let c;return ((__oak_cond)=>__oak_eq(__oak_cond,0)?(index-1):((__oak_cond)=>__oak_eq(__oak_cond,null)?-1:__oak_eq(__oak_cond,left)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(index+1),__as_oak_string(stack+1)):__oak_eq(__oak_cond,right)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(index+1),(stack-1)):__oak_trampoline(__oak_trampolined_sub,__as_oak_string(index+1),stack))((c=__oak_acc(s,__oak_obj_key((index))))))(stack)}),__oak_resolve_trampoline(__oak_trampolined_sub,index,stack)))()},((__oak_cond)=>__oak_eq(__oak_cond,-1)?null:((substr)=>((substr=slice(s,i,matchingDelimIdx)),(i=matchingDelimIdx),substr))())((matchingDelimIdx=sub(i,1)))))()},({peek,last,back,next,expect__oak_qm,readUntil,readUntilPrefix,readUntilEnd,readUntilMatchingDelim})))()},uword__oak_qm=function uword__oak_qm(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?true:(codepoint(c)>127))(word__oak_qm(c))},tokenizeText=function tokenizeText(line=null){return ((append,next,peek,push,reader,sub,tokens)=>((reader=Reader(line)),(peek=(reader.peek??null)),(next=(reader.next??null)),(tokens=[__Oak_String(``)]),push=function push(tok=null){return __oak_push(__oak_push(tokens,tok),__Oak_String(``))},append=function append(suffix=null){return __oak_push(__oak_acc(tokens,__oak_obj_key(((len(tokens)-1)))),suffix)},sub=function sub(){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(){let c;let d;return ((__oak_cond)=>__oak_eq(__oak_cond,null)?null:__oak_eq(__oak_cond,__Oak_String(`_`))?(((__oak_cond)=>__oak_eq(__oak_cond,c)?(next(),push(__as_oak_string(c+c))):push(c))(peek()),__oak_trampoline(__oak_trampolined_sub)):__oak_eq(__oak_cond,__Oak_String(`*`))?(((__oak_cond)=>__oak_eq(__oak_cond,c)?(next(),push(__as_oak_string(c+c))):push(c))(peek()),__oak_trampoline(__oak_trampolined_sub)):__oak_eq(__oak_cond,__Oak_String(`\\`))?((__oak_cond)=>__oak_eq(__oak_cond,null)?null:__oak_trampoline(__oak_trampolined_sub,append(d)))((d=next())):__oak_eq(__oak_cond,__Oak_String(`\``))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_eq(__oak_cond,__Oak_String(`~`))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_eq(__oak_cond,__Oak_String(`!`))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_eq(__oak_cond,__Oak_String(`[`))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_eq(__oak_cond,__Oak_String(`]`))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_eq(__oak_cond,__Oak_String(`(`))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_eq(__oak_cond,__Oak_String(`)`))?__oak_trampoline(__oak_trampolined_sub,push(c)):__oak_trampoline(__oak_trampolined_sub,append(c)))((c=next()))}),__oak_resolve_trampoline(__oak_trampolined_sub)))()},sub(),filter(tokens,function _(tok=null){return !__oak_eq(tok,__Oak_String(``))})))()},unifyTextNodes=function unifyTextNodes(nodes=null,joiner=null){return reduce(nodes,[],function _(acc=null,child=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('string'))?((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('string'))?(__oak_push(__oak_push(__oak_acc(acc,__oak_obj_key(((len(acc)-1)))),joiner),child),acc):__oak_push(acc,child))(type(__oak_acc(acc,__oak_obj_key(((len(acc)-1)))))):__oak_push(acc,((__oak_cond)=>__oak_eq(__oak_cond,null)?child:((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(children,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.children):(__oak_assgn_tgt.children)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(child),unifyTextNodes((child.children??null),joiner)))((child.children??null))))(type(child))})},parseText=function parseText(tokens=null){return ((handleDelimitedRange,next,peek,readUntil,readUntilMatchingDelim,reader,sub)=>((reader=Reader(tokens)),(peek=(reader.peek??null)),(next=(reader.next??null)),(readUntil=(reader.readUntil??null)),(readUntilMatchingDelim=(reader.readUntilMatchingDelim??null)),handleDelimitedRange=function handleDelimitedRange(tok=null,tag=null,nodes=null,sub=null){let range;return ((__oak_cond)=>__oak_eq(__oak_cond,null)?sub(__oak_push(nodes,tok)):(next(),sub(__oak_push(nodes,({tag,children:parseText(range)})))))((range=readUntil(tok)))},sub=function sub(nodes=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(nodes=null){let c;let range;let tok;let urlRange;return ((__oak_cond)=>__oak_eq(__oak_cond,null)?nodes:__oak_eq(__oak_cond,__Oak_String(`_`))?handleDelimitedRange(__Oak_String(`_`),Symbol.for('em'),nodes,sub):__oak_eq(__oak_cond,__Oak_String(`__`))?handleDelimitedRange(__Oak_String(`__`),Symbol.for('strong'),nodes,sub):__oak_eq(__oak_cond,__Oak_String(`*`))?handleDelimitedRange(__Oak_String(`*`),Symbol.for('em'),nodes,sub):__oak_eq(__oak_cond,__Oak_String(`**`))?handleDelimitedRange(__Oak_String(`**`),Symbol.for('strong'),nodes,sub):__oak_eq(__oak_cond,__Oak_String(`\``))?handleDelimitedRange(__Oak_String(`\``),Symbol.for('code'),nodes,sub):__oak_eq(__oak_cond,__Oak_String(`~`))?handleDelimitedRange(__Oak_String(`~`),Symbol.for('strike'),nodes,sub):__oak_eq(__oak_cond,__Oak_String(`[`))?((__oak_cond)=>__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,tok)):__oak_eq(__oak_cond,[__Oak_String(`x`)])?(next(),__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,({tag:Symbol.for('checkbox'),checked:true})))):__oak_eq(__oak_cond,[__Oak_String(` `)])?(next(),__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,({tag:Symbol.for('checkbox'),checked:false})))):((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`(`))?((__oak_cond)=>__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(__as_oak_string(__as_oak_string(tok+join(range))+__Oak_String(`]`))+c))):(next(),__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,({tag:Symbol.for('a'),href:join(urlRange),children:parseText(range)})))))((urlRange=readUntilMatchingDelim(c))):__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(__as_oak_string(tok+join(range))+__Oak_String(`]`)))):__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(__as_oak_string(__as_oak_string(tok+join(range))+__Oak_String(`]`))+c))))((c=(next(),next()))))((range=readUntilMatchingDelim(__Oak_String(`[`)))):__oak_eq(__oak_cond,__Oak_String(`!`))?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`[`))?((__oak_cond)=>__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(tok+__Oak_String(`[`)))):__oak_eq(__oak_cond,[__Oak_String(`x`)])?(next(),__oak_trampoline(__oak_trampolined_sub,__oak_push(__oak_push(nodes,tok),({tag:Symbol.for('checkbox'),checked:true})))):__oak_eq(__oak_cond,[__Oak_String(` `)])?(next(),__oak_trampoline(__oak_trampolined_sub,__oak_push(__oak_push(nodes,tok),({tag:Symbol.for('checkbox'),checked:false})))):((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`(`))?((__oak_cond)=>__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(tok+__Oak_String(`[`))+join(range))+__Oak_String(`]`))+c))):(next(),__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,({tag:Symbol.for('img'),alt:join(range),src:join(urlRange)})))))((urlRange=readUntilMatchingDelim(c))):__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(__as_oak_string(__as_oak_string(tok+__Oak_String(`[`))+join(range))+__Oak_String(`]`)))):__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,__as_oak_string(__as_oak_string(__as_oak_string(__as_oak_string(tok+__Oak_String(`[`))+join(range))+__Oak_String(`]`))+c))))((c=(next(),next()))))((range=(next(),readUntilMatchingDelim(__Oak_String(`[`))))):__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,tok)))(peek()):__oak_trampoline(__oak_trampolined_sub,__oak_push(nodes,tok)))((tok=next()))}),__oak_resolve_trampoline(__oak_trampolined_sub,nodes)))()},unifyTextNodes(sub([]),__Oak_String(``))))()},uListItemLine__oak_qm=function uListItemLine__oak_qm(line=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?false:startsWith__oak_qm(trimStart(line),__Oak_String(`- `)))(line)},oListItemLine__oak_qm=function oListItemLine__oak_qm(line=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?false:((dotIdx,trimmedStart)=>((trimmedStart=trimStart(line)),((__oak_cond)=>__oak_eq(__oak_cond,-1)?false:__oak_eq(__oak_cond,0)?false:every(split(slice(trimmedStart,0,dotIdx)),digit__oak_qm))((dotIdx=indexOf(trimmedStart,__Oak_String(`. `))))))())(line)},listItemLine__oak_qm=function listItemLine__oak_qm(line=null){return (__oak_left=>__oak_left===true?true:__oak_or(__oak_left,oListItemLine__oak_qm(line)))(uListItemLine__oak_qm(line))},trimUListGetLevel=function trimUListGetLevel(reader=null){return ((level)=>((level=len((reader.readUntil)(__Oak_String(`-`)))),(reader.next)(),(reader.next)(),level))()},trimOListGetLevel=function trimOListGetLevel(reader=null){return ((level,next,peek,sub)=>((peek=(reader.peek??null)),(next=(reader.next??null)),sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?(next(),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1))):i)(space__oak_qm(peek()))}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},(level=sub(0)),(reader.readUntil)(__Oak_String(`.`)),next(),((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(` `))?next():null)(peek()),level))()},lineNodeType=function lineNodeType(line=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__oak_eq(line,null))?null:__oak_eq(__oak_cond,__oak_eq(line,__Oak_String(``)))?Symbol.for('empty'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`# `)))?Symbol.for('h1'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`## `)))?Symbol.for('h2'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`### `)))?Symbol.for('h3'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`#### `)))?Symbol.for('h4'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`##### `)))?Symbol.for('h5'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`###### `)))?Symbol.for('h6'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`>`)))?Symbol.for('blockquote'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`\`\`\``)))?Symbol.for('pre'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`---`)))?Symbol.for('hr'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`***`)))?Symbol.for('hr'):__oak_eq(__oak_cond,startsWith__oak_qm(line,__Oak_String(`!html`)))?Symbol.for('rawHTML'):__oak_eq(__oak_cond,uListItemLine__oak_qm(line))?Symbol.for('ul'):__oak_eq(__oak_cond,oListItemLine__oak_qm(line))?Symbol.for('ol'):Symbol.for('p'))(true)},parse=function parse(text=null){return parseDoc(Reader(split(text,__Oak_String(`
`))))},parseDoc=function parseDoc(lineReader=null){return ((sub)=>(sub=function sub(doc=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(doc=null){let nodeType;return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('h1'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseHeader(nodeType,lineReader))):__oak_eq(__oak_cond,Symbol.for('h2'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseHeader(nodeType,lineReader))):__oak_eq(__oak_cond,Symbol.for('h3'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseHeader(nodeType,lineReader))):__oak_eq(__oak_cond,Symbol.for('h4'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseHeader(nodeType,lineReader))):__oak_eq(__oak_cond,Symbol.for('h5'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseHeader(nodeType,lineReader))):__oak_eq(__oak_cond,Symbol.for('h6'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseHeader(nodeType,lineReader))):__oak_eq(__oak_cond,Symbol.for('blockquote'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseBlockQuote(lineReader))):__oak_eq(__oak_cond,Symbol.for('pre'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseCodeBlock(lineReader))):__oak_eq(__oak_cond,Symbol.for('ul'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseList(lineReader,nodeType))):__oak_eq(__oak_cond,Symbol.for('ol'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseList(lineReader,nodeType))):__oak_eq(__oak_cond,Symbol.for('rawHTML'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseRawHTML(lineReader))):__oak_eq(__oak_cond,Symbol.for('p'))?__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,parseParagraph(lineReader))):__oak_eq(__oak_cond,Symbol.for('hr'))?((lineReader.next)(),__oak_trampoline(__oak_trampolined_sub,__oak_push(doc,({tag:Symbol.for('hr')})))):__oak_eq(__oak_cond,Symbol.for('empty'))?((lineReader.next)(),__oak_trampoline(__oak_trampolined_sub,doc)):doc)((nodeType=lineNodeType((lineReader.peek)())))}),__oak_resolve_trampoline(__oak_trampolined_sub,doc)))()},sub([])))()},parseHeader=function parseHeader(nodeType=null,lineReader=null){return ((reader,text)=>((reader=Reader((lineReader.next)())),(reader.readUntil)(__Oak_String(` `)),(reader.next)(),(text=(reader.readUntilEnd)()),({tag:nodeType,children:parseText(tokenizeText(text))})))()},parseBlockQuote=function parseBlockQuote(lineReader=null){return ((BlockQuoteLineReader,next,peek)=>((peek=(lineReader.peek??null)),(next=(lineReader.next??null)),BlockQuoteLineReader=function BlockQuoteLineReader(lineReader=null){return ((back,expect__oak_qm,last,next,peek,readUntil,readUntilMatchingDelim,readUntilPrefix,returnIfQuoted)=>(returnIfQuoted=function returnIfQuoted(line=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('blockquote'))?slice(line,1):null)(lineNodeType(line))},peek=function peek(){return returnIfQuoted((lineReader.peek)())},last=function last(){return returnIfQuoted((lineReader.last)())},back=function back(){return (lineReader.back)()},next=function next(){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('blockquote'))?trimStart((lineReader.next)(),__Oak_String(`>`)):null)(lineNodeType((lineReader.peek)()))},expect__oak_qm=function expect__oak_qm(){return null},readUntil=function readUntil(c=null){return map((lineReader.readdUntil)(__oak_push(__Oak_String(`>`),c)),function _(line=null){return slice(line,1)})},readUntilPrefix=function readUntilPrefix(prefix=null){return map((lineReader.readUntilPrefix)(__oak_push(__Oak_String(`>`),c)),function _(line=null){return slice(line,1)})},readUntilMatchingDelim=function readUntilMatchingDelim(){return null},({peek,last,back,next,expect__oak_qm,readUntil,readUntilPrefix,readUntilEnd:(lineReader.readUntilEnd??null),readUntilMatchingDelim})))()},({tag:Symbol.for('blockquote'),children:parseDoc(BlockQuoteLineReader(lineReader))})))()},parseCodeBlock=function parseCodeBlock(lineReader=null){return ((children,lang,next,peek,rest,startTag,sub)=>((peek=(lineReader.peek??null)),(next=(lineReader.next??null)),(startTag=next()),(lang=((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(``))?__Oak_String(``):rest)((rest=slice(startTag,3)))),sub=function sub(lines=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(lines=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('pre'))?lines:__oak_eq(__oak_cond,null)?lines:__oak_trampoline(__oak_trampolined_sub,__oak_push(lines,next())))(lineNodeType(peek()))}),__oak_resolve_trampoline(__oak_trampolined_sub,lines)))()},(children=sub([])),next(),({tag:Symbol.for('pre'),children:[({tag:Symbol.for('code'),lang,children:unifyTextNodes(children,__Oak_String(`
`))})]})))()},parseRawHTML=function parseRawHTML(lineReader=null){return ((children,firstLine,next,peek,startMarkLine,sub)=>((peek=(lineReader.peek??null)),(next=(lineReader.next??null)),(startMarkLine=next()),(firstLine=slice(startMarkLine,len(__Oak_String(`!html `)))),sub=function sub(lines=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(lines=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('empty'))?lines:__oak_eq(__oak_cond,null)?lines:__oak_trampoline(__oak_trampolined_sub,__oak_push(lines,next())))(lineNodeType(peek()))}),__oak_resolve_trampoline(__oak_trampolined_sub,lines)))()},(children=sub([firstLine])),({tag:Symbol.for('rawHTML'),children:unifyTextNodes(children,__Oak_String(`
`))})))()},parseList=function parseList(lineReader=null,listType=null){return ((children,next,peek,sub)=>((peek=(lineReader.peek??null)),(next=(lineReader.next??null)),sub=function sub(items=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(items=null){return ((__oak_cond)=>__oak_eq(__oak_cond,false)?items:((lastItem,level,line,lineType,listItem,reader,text,trimmer)=>((line=next()),(lineType=lineNodeType(line)),(reader=Reader(line)),(trimmer=((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('ul'))?trimUListGetLevel:__oak_eq(__oak_cond,Symbol.for('ol'))?trimOListGetLevel:null)(lineType)),(level=trimmer(reader)),(text=(reader.readUntilEnd)()),(listItem=({tag:Symbol.for('li'),level,children:parseText(tokenizeText(text))})),((__oak_cond)=>__oak_eq(__oak_cond,null)?__oak_trampoline(__oak_trampolined_sub,__oak_push(items,listItem)):((__oak_cond)=>__oak_eq(__oak_cond,__oak_eq((lastItem.level??null),level))?((__oak_cond)=>__oak_eq(__oak_cond,listType)?__oak_trampoline(__oak_trampolined_sub,__oak_push(items,listItem)):((lineReader.back)(),items))(lineType):__oak_eq(__oak_cond,((lastItem.level??null)<level))?((list)=>((lineReader.back)(),(list=parseList(lineReader,lineType)),__oak_push((lastItem.children??null),list),__oak_trampoline(__oak_trampolined_sub,items)))():((lineReader.back)(),items))(true))((lastItem=__oak_acc(items,__oak_obj_key(((len(items)-1))))))))())(listItemLine__oak_qm(peek()))}),__oak_resolve_trampoline(__oak_trampolined_sub,items)))()},(children=sub([])),each(children,function _(child=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign(level,__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt.level):(__oak_assgn_tgt.level)=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(child),__Oak_Empty):null)(__oak_eq((child.tag??null),Symbol.for('li')))}),({tag:listType,children})))()},parseParagraph=function parseParagraph(lineReader=null){return ((next,peek,sub)=>((peek=(lineReader.peek??null)),(next=(lineReader.next??null)),sub=function sub(lines=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(lines=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('p'))?((text)=>((text=next()),((__oak_cond)=>__oak_eq(__oak_cond,[true,__Oak_Empty])?(append(lines,parseText(tokenizeText(take(text,(len(text)-2))))),__oak_trampoline(__oak_trampolined_sub,__oak_push(lines,({tag:Symbol.for('br')})))):__oak_eq(__oak_cond,[__Oak_Empty,__Oak_String(`\\`)])?(append(lines,parseText(tokenizeText(take(text,(len(text)-1))))),__oak_trampoline(__oak_trampolined_sub,__oak_push(lines,({tag:Symbol.for('br')})))):__oak_trampoline(__oak_trampolined_sub,append(lines,parseText(tokenizeText(text)))))([endsWith__oak_qm(text,__Oak_String(`  `)),__oak_acc(text,__oak_obj_key(((len(text)-1))))])))():lines)(lineNodeType(peek()))}),__oak_resolve_trampoline(__oak_trampolined_sub,lines)))()},({tag:Symbol.for('p'),children:unifyTextNodes(sub([]),__Oak_String(` `))})))()},compile=function compile(nodes=null){return join(map(nodes,compileNode))},wrap=function wrap(tag=null,node=null){return __oak_push(__oak_push(__oak_push(__oak_push(__oak_push(__oak_push(__Oak_String(`<`),tag),__Oak_String(`>`)),compile((node.children??null))),__Oak_String(`</`)),tag),__Oak_String(`>`))},sanitizeAttr=function sanitizeAttr(attr=null){return (map(attr,function _(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`<`))?__Oak_String(`&lt;`):__oak_eq(__oak_cond,__Oak_String(`'`))?__Oak_String(`&apos;`):__oak_eq(__oak_cond,__Oak_String(`"`))?__Oak_String(`&quot;`):c)(c)}))},sanitizeURL=function sanitizeURL(url=null){return ((encodedURL)=>((encodedURL=lower(map(percentDecode(url),function _(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,word__oak_qm(c))?c:__oak_eq(__oak_cond,__oak_eq(c,__Oak_String(`/`)))?c:__oak_eq(__oak_cond,__oak_eq(c,__Oak_String(`:`)))?c:__Oak_String(``))(true)}))),((__oak_cond)=>__oak_eq(__oak_cond,startsWith__oak_qm(encodedURL,__Oak_String(`javascript:`)))?__Oak_String(``):__oak_eq(__oak_cond,startsWith__oak_qm(encodedURL,__Oak_String(`data:`)))?__Oak_String(``):sanitizeAttr(url))(true)))()},compileNode=function compileNode(node=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('string'))?map(node,function _(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(`&`))?__Oak_String(`&amp;`):__oak_eq(__oak_cond,__Oak_String(`<`))?__Oak_String(`&lt;`):c)(c)}):((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('p'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('em'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('strong'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('strike'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('h1'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('h2'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('h3'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('h4'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('h5'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('h6'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('pre'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('ul'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('ol'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('li'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('blockquote'))?wrap(string((node.tag??null)),node):__oak_eq(__oak_cond,Symbol.for('a'))?format(__Oak_String(`<a href="{{0}}">{{1}}</a>`),sanitizeURL((node.href??null)),compile((node.children??null))):__oak_eq(__oak_cond,Symbol.for('img'))?format(__Oak_String(`<img alt="{{0}}" src="{{1}}"/>`),sanitizeAttr((node.alt??null)),sanitizeURL((node.src??null))):__oak_eq(__oak_cond,Symbol.for('code'))?((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(``))?wrap(__Oak_String(`code`),node):__oak_eq(__oak_cond,null)?wrap(__Oak_String(`code`),node):format(__Oak_String(`<code data-lang="{{0}}">{{1}}</code>`),sanitizeAttr((node.lang??null)),compile((node.children??null))))((node.lang??null)):__oak_eq(__oak_cond,Symbol.for('checkbox'))?__oak_push(__oak_push(__Oak_String(`<input type="checkbox" `),((__oak_cond)=>__oak_eq(__oak_cond,true)?__Oak_String(`checked`):__Oak_String(``))((node.checked??null))),__Oak_String(`/>`)):__oak_eq(__oak_cond,Symbol.for('br'))?__Oak_String(`<br/>`):__oak_eq(__oak_cond,Symbol.for('hr'))?__Oak_String(`<hr/>`):__oak_eq(__oak_cond,Symbol.for('rawHTML'))?__oak_acc((node.children??null),0):format(__Oak_String(`<span style="color:red">Unknown Markdown node {{0}}</span>`),compileNode(string(node))))((node.tag??null)))(type(node))},transform=function transform(text=null){return compile(parse(text))},({Reader,append,compile,compileNode,digit__oak_qm,each,endsWith__oak_qm,every,filter,format,indexOf,join,letter__oak_qm,lineNodeType,listItemLine__oak_qm,lower,map,oListItemLine__oak_qm,parse,parseBlockQuote,parseCodeBlock,parseDoc,parseHeader,parseList,parseParagraph,parseRawHTML,parseText,percentDecode,reduce,replace,sanitizeAttr,sanitizeURL,slice,space__oak_qm,split,startsWith__oak_qm,take,tokenizeText,transform,trimOListGetLevel,trimStart,trimUListGetLevel,uListItemLine__oak_qm,unifyTextNodes,uword__oak_qm,word__oak_qm,wrap})))()}),__oak_modularize(__Oak_String(`sort`),function _(){return ((clone,__oak_js_default,id,map,sort,sort__oak_exclam)=>(({__oak_js_default,identity:id=null,map,clone}=__oak_module_import(__Oak_String(`std`))),sort__oak_exclam=function sort__oak_exclam(xs=null,pred=null){return ((partition,quicksort,vpred)=>((pred=__oak_js_default(pred,id)),(vpred=map(xs,pred)),partition=function partition(xs=null,lo=null,hi=null){return ((lsub,pivot,rsub,sub)=>((pivot=__oak_acc(vpred,__oak_obj_key((lo)))),lsub=function lsub(i=null){return ((__oak_trampolined_lsub)=>((__oak_trampolined_lsub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_lsub,__as_oak_string(i+1)):i)((__oak_acc(vpred,__oak_obj_key((i)))<pivot))}),__oak_resolve_trampoline(__oak_trampolined_lsub,i)))()},rsub=function rsub(j=null){return ((__oak_trampolined_rsub)=>((__oak_trampolined_rsub=function _(j=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_rsub,(j-1)):j)((__oak_acc(vpred,__oak_obj_key((j)))>pivot))}),__oak_resolve_trampoline(__oak_trampolined_rsub,j)))()},sub=function sub(i=null,j=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null,j=null){return ((i=lsub(i)),(j=rsub(j)),((__oak_cond)=>__oak_eq(__oak_cond,false)?j:((tmp,tmpPred)=>((tmp=__oak_acc(xs,__oak_obj_key((i)))),(tmpPred=__oak_acc(vpred,__oak_obj_key((i)))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((i),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((i))]):(__oak_assgn_tgt[__oak_obj_key((i))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(xs),__oak_acc(xs,__oak_obj_key((j)))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((j),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((j))]):(__oak_assgn_tgt[__oak_obj_key((j))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(xs),tmp),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((i),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((i))]):(__oak_assgn_tgt[__oak_obj_key((i))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(vpred),__oak_acc(vpred,__oak_obj_key((j)))),((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((j),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((j))]):(__oak_assgn_tgt[__oak_obj_key((j))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(vpred),tmpPred),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1),(j-1))))())((i<j)))}),__oak_resolve_trampoline(__oak_trampolined_sub,i,j)))()},sub(lo,hi)))()},quicksort=function quicksort(xs=null,lo=null,hi=null){return ((__oak_trampolined_quicksort)=>((__oak_trampolined_quicksort=function _(xs=null,lo=null,hi=null){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?xs:__oak_eq(__oak_cond,1)?xs:((__oak_cond)=>__oak_eq(__oak_cond,false)?xs:((p)=>((p=partition(xs,lo,hi)),quicksort(xs,lo,p),__oak_trampoline(__oak_trampolined_quicksort,xs,__as_oak_string(p+1),hi)))())((lo<hi)))(len(xs))}),__oak_resolve_trampoline(__oak_trampolined_quicksort,xs,lo,hi)))()},quicksort(xs,0,(len(xs)-1))))()},sort=function sort(xs=null,pred=null){return sort__oak_exclam(clone(xs),pred)},({clone,__oak_js_default,id,map,sort,sort__oak_exclam})))()}),__oak_modularize(__Oak_String(`std`),function _(){return ((_asPredicate,_baseIterator,_hToN,_nToH,append,clamp,clone,compact,contains__oak_qm,debounce,__oak_js_default,each,entries,every,filter,find,first,flatten,fromHex,identity,indexOf,join,last,loop,map,merge,once,partition,println,range,reduce,reverse,slice,some,stdin,take,takeLast,toHex,uniq,values,zip)=>(identity=function identity(x=null){return x},_baseIterator=function _baseIterator(v=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('string'))?__Oak_String(``):__oak_eq(__oak_cond,Symbol.for('list'))?[]:__oak_eq(__oak_cond,Symbol.for('object'))?({}):null)(type(v))},_asPredicate=function _asPredicate(pred=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('atom'))?((prop)=>((prop=string(pred)),function _(x=null){return __oak_acc(x,__oak_obj_key((prop)))}))():__oak_eq(__oak_cond,Symbol.for('string'))?function _(x=null){return __oak_acc(x,__oak_obj_key((pred)))}:__oak_eq(__oak_cond,Symbol.for('int'))?function _(x=null){return __oak_acc(x,__oak_obj_key((pred)))}:pred)(type(pred))},__oak_js_default=function __oak_js_default(x=null,base=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?base:x)(x)},(_nToH=__Oak_String(`0123456789abcdef`)),toHex=function toHex(n=null){return ((sub)=>(sub=function sub(p=null,acc=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(p=null,acc=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__as_oak_string(__oak_acc(_nToH,__oak_obj_key((p)))+acc):__oak_trampoline(__oak_trampolined_sub,int((p/16)),__as_oak_string(__oak_acc(_nToH,__oak_obj_key(((p%16))))+acc)))((p<16))}),__oak_resolve_trampoline(__oak_trampolined_sub,p,acc)))()},sub(int(n),__Oak_String(``))))()},(_hToN=({0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15})),fromHex=function fromHex(s=null){return ((sub)=>(sub=function sub(i=null,acc=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null,acc=null){let next;return ((__oak_cond)=>__oak_eq(__oak_cond,__oak_eq(i,len(s)))?acc:__oak_eq(__oak_cond,!__oak_eq(null,(next=__oak_acc(_hToN,__oak_obj_key((__oak_acc(s,__oak_obj_key((i)))))))))?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1),__as_oak_string((acc*16)+next)):null)(true)}),__oak_resolve_trampoline(__oak_trampolined_sub,i,acc)))()},sub(0,0)))()},clamp=function clamp(min=null,max=null,n=null,m=null){return ((n=((__oak_cond)=>__oak_eq(__oak_cond,true)?min:n)((n<min))),(m=((__oak_cond)=>__oak_eq(__oak_cond,true)?min:m)((m<min))),(m=((__oak_cond)=>__oak_eq(__oak_cond,true)?max:m)((m>max))),(n=((__oak_cond)=>__oak_eq(__oak_cond,true)?m:n)((n>m))),[n,m])},slice=function slice(xs=null,min=null,max=null){return ((sub)=>((min=__oak_js_default(min,0)),(max=__oak_js_default(max,len(xs))),([min=null,max=null]=clamp(0,len(xs),min,max)),sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,max)?acc:__oak_trampoline(__oak_trampolined_sub,__oak_push(acc,__oak_acc(xs,__oak_obj_key((i)))),__as_oak_string(i+1)))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub(_baseIterator(xs),min)))()},clone=function clone(x=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('string'))?__as_oak_string(__Oak_String(``)+x):__oak_eq(__oak_cond,Symbol.for('list'))?slice(x):__oak_eq(__oak_cond,Symbol.for('object'))?reduce(keys(x),({}),function _(acc=null,key=null){return ((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((key),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((key))]):(__oak_assgn_tgt[__oak_obj_key((key))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(acc),__oak_acc(x,__oak_obj_key((key))))}):x)(type(x))},range=function range(start=null,end=null,step=null){return ((step=__oak_js_default(step,1)),((__oak_cond)=>__oak_eq(__oak_cond,true)?([start=null,end=null]=[0,start]):null)(__oak_eq(end,null)),((__oak_cond)=>__oak_eq(__oak_cond,0)?[]:((list,sub)=>((list=[]),((__oak_cond)=>__oak_eq(__oak_cond,true)?sub=function sub(n=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?(__oak_push(list,n),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(n+step))):list)((n<end))}),__oak_resolve_trampoline(__oak_trampolined_sub,n)))()}:sub=function sub(n=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(n=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?(__oak_push(list,n),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(n+step))):list)((n>end))}),__oak_resolve_trampoline(__oak_trampolined_sub,n)))()})((step>0)),sub(start)))())(step))},reverse=function reverse(xs=null){return ((sub)=>(sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?acc:__oak_trampoline(__oak_trampolined_sub,__oak_push(acc,__oak_acc(xs,__oak_obj_key((i)))),(i-1)))((i<0))}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub(_baseIterator(xs),(len(xs)-1))))()},map=function map(xs=null,f=null){return ((sub)=>((f=_asPredicate(f)),sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?acc:__oak_trampoline(__oak_trampolined_sub,__oak_push(acc,f(__oak_acc(xs,__oak_obj_key((i))),i)),__as_oak_string(i+1)))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub(_baseIterator(xs),0)))()},each=function each(xs=null,f=null){return ((sub)=>(sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?null:(f(__oak_acc(xs,__oak_obj_key((i))),i),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1))))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},filter=function filter(xs=null,f=null){return ((sub)=>((f=_asPredicate(f)),sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?acc:((x)=>(((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_push(acc,x):null)(f((x=__oak_acc(xs,__oak_obj_key((i)))),i)),__oak_trampoline(__oak_trampolined_sub,acc,__as_oak_string(i+1))))())(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub(_baseIterator(xs),0)))()},reduce=function reduce(xs=null,seed=null,f=null){return ((sub)=>(sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?acc:__oak_trampoline(__oak_trampolined_sub,f(acc,__oak_acc(xs,__oak_obj_key((i))),i),__as_oak_string(i+1)))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub(seed,0)))()},flatten=function flatten(xs=null){return reduce(xs,[],append)},compact=function compact(xs=null){return filter(xs,function _(x=null){return !__oak_eq(x,null)})},some=function some(xs=null,pred=null){return ((pred=__oak_js_default(pred,identity)),reduce(xs,false,function _(acc=null,x=null,i=null){return (__oak_left=>__oak_left===true?true:__oak_or(__oak_left,pred(x,i)))(acc)}))},every=function every(xs=null,pred=null){return ((pred=__oak_js_default(pred,identity)),reduce(xs,true,function _(acc=null,x=null,i=null){return (__oak_left=>__oak_left===false?false:__oak_and(__oak_left,pred(x,i)))(acc)}))},append=function append(xs=null,ys=null){return reduce(ys,xs,function _(zs=null,y=null){return __oak_push(zs,y)})},join=function join(xs=null,ys=null){return append(clone(xs),ys)},zip=function zip(xs=null,ys=null,zipper=null){return ((max,sub)=>((zipper=__oak_js_default(zipper,function _(x=null,y=null){return [x,y]})),(max=((__oak_cond)=>__oak_eq(__oak_cond,true)?len(xs):len(ys))((len(xs)<len(ys)))),sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,max)?acc:__oak_trampoline(__oak_trampolined_sub,__oak_push(acc,zipper(__oak_acc(xs,__oak_obj_key((i))),__oak_acc(ys,__oak_obj_key((i))),i)),__as_oak_string(i+1)))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub([],0)))()},partition=function partition(xs=null,by=null){return ((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('int'))?reduce(xs,[],function _(acc=null,x=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?__oak_push(acc,[x]):(__oak_push(__oak_acc(acc,__oak_obj_key(((len(acc)-1)))),x),acc))((i%by))}):__oak_eq(__oak_cond,Symbol.for('function'))?((last)=>((last=function _(){return null}),reduce(xs,[],function _(acc=null,x=null){return ((__oak_js_this)=>(((__oak_cond)=>__oak_eq(__oak_cond,last)?__oak_push(__oak_acc(acc,__oak_obj_key(((len(acc)-1)))),x):__oak_push(acc,[x]))((__oak_js_this=by(x))),(last=__oak_js_this),acc))()})))():null)(type(by))},uniq=function uniq(xs=null,pred=null){return ((last,sub,ys)=>((pred=__oak_js_default(pred,identity)),(ys=_baseIterator(xs)),(last=function _(){return null}),sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){let p;let x;return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?ys:((__oak_cond)=>__oak_eq(__oak_cond,last)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)):(__oak_push(ys,x),(last=p),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1))))((p=pred((x=__oak_acc(xs,__oak_obj_key((i))))))))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},first=function first(xs=null){return __oak_acc(xs,0)},last=function last(xs=null){return __oak_acc(xs,__oak_obj_key(((len(xs)-1))))},take=function take(xs=null,n=null){return slice(xs,0,n)},takeLast=function takeLast(xs=null,n=null){return slice(xs,(len(xs)-n))},find=function find(xs=null,pred=null){return ((sub)=>(sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?-1:((__oak_cond)=>__oak_eq(__oak_cond,true)?i:__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)))(pred(__oak_acc(xs,__oak_obj_key((i))))))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},indexOf=function indexOf(xs=null,x=null){return ((sub)=>(sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,len(xs))?-1:((__oak_cond)=>__oak_eq(__oak_cond,x)?i:__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)))(__oak_acc(xs,__oak_obj_key((i)))))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},contains__oak_qm=function contains__oak_qm(xs=null,x=null){return (indexOf(xs,x)>-1)},values=function values(obj=null){return map(keys(obj),function _(key=null){return __oak_acc(obj,__oak_obj_key((key)))})},entries=function entries(obj=null){return map(keys(obj),function _(key=null){return [key,__oak_acc(obj,__oak_obj_key((key)))]})},merge=function merge(...os){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?null:reduce(os,__oak_acc(os,0),function _(acc=null,o=null){return (reduce(keys(o),acc,function _(root=null,k=null){return ((__oak_assgn_tgt,__oak_assgn_val)=>(__is_oak_string(__oak_assgn_tgt)?__oak_assgn_tgt.assign((k),__oak_assgn_val):__oak_assgn_val===__Oak_Empty?delete (__oak_assgn_tgt[__oak_obj_key((k))]):(__oak_assgn_tgt[__oak_obj_key((k))])=__oak_assgn_val,__oak_assgn_tgt))(__as_oak_string(root),__oak_acc(o,__oak_obj_key((k))))}))}))(len(os))},once=function once(f=null){return ((called__oak_qm)=>((called__oak_qm=false),function _(...args){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((called__oak_qm=true),f(...args)):null)(!called__oak_qm)}))()},loop=function loop(max=null,f=null){return ((breaker,broken,ret,sub)=>(((__oak_cond)=>__oak_eq(__oak_cond,true)?([max=null,f=null]=[-1,max]):null)(__oak_eq(f,null)),(max=__oak_js_default(max,-1)),(ret=null),(broken=false),breaker=function breaker(x=null){return ((ret=x),(broken=true))},sub=function sub(count=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(count=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_cond)=>__oak_eq(__oak_cond,broken)?ret:(f(count,breaker),__oak_trampoline(__oak_trampolined_sub,__as_oak_string(count+1))))(true):null)(!__oak_eq(count,max))}),__oak_resolve_trampoline(__oak_trampolined_sub,count)))()},sub(0)))()},debounce=function debounce(duration=null,firstCall=null,f=null){return ((dargs,debounced,target,waiting__oak_qm)=>(((__oak_cond)=>__oak_eq(__oak_cond,true)?([firstCall=null,f=null]=[Symbol.for('trailing'),firstCall]):null)(__oak_eq(f,null)),(dargs=null),(waiting__oak_qm=false),(target=(time()-duration)),debounced=function debounced(...args){return ((tcall)=>((tcall=time()),(dargs=args),((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_cond)=>__oak_eq(__oak_cond,true)?((target=__as_oak_string(tcall+duration)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('leading'))?f(...dargs):__oak_eq(__oak_cond,Symbol.for('trailing'))?((waiting__oak_qm=true),wait((target-time()),function _(){return ((waiting__oak_qm=false),f(...dargs))})):null)(firstCall)):((timeout)=>((waiting__oak_qm=true),(timeout=(target-tcall)),(target=__as_oak_string(target+duration)),wait(timeout,function _(){return ((waiting__oak_qm=false),f(...dargs))})))())((target<=tcall)):null)(!waiting__oak_qm)))()}))()},stdin=function stdin(){return ((file)=>((file=__Oak_String(``)),loop(function _(__oak_empty_ident0=null,__oak_js_break=null){return ((evt)=>((evt=input()),__oak_push(file,(evt.data??null)),((__oak_cond)=>__oak_eq(__oak_cond,Symbol.for('error'))?__oak_js_break(file):__oak_push(file,__Oak_String(`
`)))((evt.type??null))))()})))()},println=function println(...xs){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?print(__Oak_String(`
`)):((out)=>((out=reduce(slice(xs,1),string(__oak_acc(xs,0)),function _(acc=null,x=null){return (__as_oak_string(__as_oak_string(acc+__Oak_String(` `))+string(x)))})),print(__as_oak_string(out+__Oak_String(`
`)))))())(len(xs))},({_asPredicate,_baseIterator,_hToN,_nToH,append,clamp,clone,compact,contains__oak_qm,debounce,__oak_js_default,each,entries,every,filter,find,first,flatten,fromHex,identity,indexOf,join,last,loop,map,merge,once,partition,println,range,reduce,reverse,slice,some,stdin,take,takeLast,toHex,uniq,values,zip})))()}),__oak_modularize(__Oak_String(`str`),function _(){return ((_extend,_matchesAt__oak_qm,_replaceNonEmpty,_splitNonEmpty,_trimEndNonEmpty,_trimEndSpace,_trimStartNonEmpty,_trimStartSpace,checkRange,contains__oak_qm,cut,__oak_js_default,digit__oak_qm,endsWith__oak_qm,indexOf,join,letter__oak_qm,lower,lower__oak_qm,padEnd,padStart,reduce,replace,slice,space__oak_qm,split,startsWith__oak_qm,take,takeLast,trim,trimEnd,trimStart,upper,upper__oak_qm,word__oak_qm)=>(({__oak_js_default,slice,take,takeLast,reduce}=__oak_module_import(__Oak_String(`std`))),checkRange=function checkRange(lo=null,hi=null){let checker;return checker=function checker(c=null){return ((p)=>((p=codepoint(c)),(__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(p<=hi)))((lo<=p))))()}},upper__oak_qm=function upper__oak_qm(c=null){return (__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(c<=__Oak_String(`Z`))))((c>=__Oak_String(`A`)))},lower__oak_qm=function lower__oak_qm(c=null){return (__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(c<=__Oak_String(`z`))))((c>=__Oak_String(`a`)))},digit__oak_qm=function digit__oak_qm(c=null){return (__oak_left=>__oak_left===false?false:__oak_and(__oak_left,(c<=__Oak_String(`9`))))((c>=__Oak_String(`0`)))},space__oak_qm=function space__oak_qm(c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(` `))?true:__oak_eq(__oak_cond,__Oak_String(`	`))?true:__oak_eq(__oak_cond,__Oak_String(`
`))?true:__oak_eq(__oak_cond,__Oak_String(``))?true:__oak_eq(__oak_cond,__Oak_String(``))?true:false)(c)},letter__oak_qm=function letter__oak_qm(c=null){return (__oak_left=>__oak_left===true?true:__oak_or(__oak_left,lower__oak_qm(c)))(upper__oak_qm(c))},word__oak_qm=function word__oak_qm(c=null){return (__oak_left=>__oak_left===true?true:__oak_or(__oak_left,digit__oak_qm(c)))(letter__oak_qm(c))},join=function join(strings=null,joiner=null){return ((joiner=__oak_js_default(joiner,__Oak_String(``))),((__oak_cond)=>__oak_eq(__oak_cond,0)?__Oak_String(``):reduce(slice(strings,1),__oak_acc(strings,0),function _(a=null,b=null){return __as_oak_string(__as_oak_string(a+joiner)+b)}))(len(strings)))},startsWith__oak_qm=function startsWith__oak_qm(s=null,prefix=null){return __oak_eq(take(s,len(prefix)),prefix)},endsWith__oak_qm=function endsWith__oak_qm(s=null,suffix=null){return __oak_eq(takeLast(s,len(suffix)),suffix)},_matchesAt__oak_qm=function _matchesAt__oak_qm(s=null,substr=null,idx=null){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?true:__oak_eq(__oak_cond,1)?__oak_eq(__oak_acc(s,__oak_obj_key((idx))),substr):((max,sub)=>((max=len(substr)),sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,max)?true:((__oak_cond)=>__oak_eq(__oak_cond,__oak_acc(substr,__oak_obj_key((i))))?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)):false)(__oak_acc(s,__oak_obj_key((__as_oak_string(idx+i))))))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))())(len(substr))},indexOf=function indexOf(s=null,substr=null){return ((max,sub)=>((max=(len(s)-len(substr))),sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?i:((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+1)):-1)((i<max)))(_matchesAt__oak_qm(s,substr,i))}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},sub(0)))()},contains__oak_qm=function contains__oak_qm(s=null,substr=null){return (indexOf(s,substr)>=0)},cut=function cut(s=null,sep=null){let idx;return ((__oak_cond)=>__oak_eq(__oak_cond,-1)?[s,__Oak_String(``)]:[slice(s,0,idx),slice(s,__as_oak_string(idx+len(sep)))])((idx=indexOf(s,sep)))},lower=function lower(s=null){return reduce(s,__Oak_String(``),function _(acc=null,c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_push(acc,char(__as_oak_string(codepoint(c)+32))):__oak_push(acc,c))(upper__oak_qm(c))})},upper=function upper(s=null){return reduce(s,__Oak_String(``),function _(acc=null,c=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_push(acc,char((codepoint(c)-32))):__oak_push(acc,c))(lower__oak_qm(c))})},_replaceNonEmpty=function _replaceNonEmpty(s=null,old=null,__oak_js_new=null){return ((lnew,lold,sub)=>((lold=len(old)),(lnew=len(__oak_js_new)),sub=function sub(acc=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(__as_oak_string(slice(acc,0,i)+__oak_js_new)+slice(acc,__as_oak_string(i+lold))),__as_oak_string(i+lnew)):((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_sub,acc,__as_oak_string(i+1)):acc)((i<len(acc))))(_matchesAt__oak_qm(acc,old,i))}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i)))()},sub(s,0)))()},replace=function replace(s=null,old=null,__oak_js_new=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(``))?s:_replaceNonEmpty(s,old,__oak_js_new))(old)},_splitNonEmpty=function _splitNonEmpty(s=null,sep=null){return ((coll,lsep,sub)=>((coll=[]),(lsep=len(sep)),sub=function sub(acc=null,i=null,last=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(acc=null,i=null,last=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?(__oak_push(coll,slice(acc,last,i)),__oak_trampoline(__oak_trampolined_sub,acc,__as_oak_string(i+lsep),__as_oak_string(i+lsep))):((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_sub,acc,__as_oak_string(i+1),last):__oak_push(coll,slice(acc,last)))((i<len(acc))))(_matchesAt__oak_qm(acc,sep,i))}),__oak_resolve_trampoline(__oak_trampolined_sub,acc,i,last)))()},sub(s,0,0)))()},split=function split(s=null,sep=null){return ((__oak_cond)=>__oak_eq(__oak_cond,null)?reduce(s,[],function _(acc=null,c=null){return __oak_push(acc,c)}):__oak_eq(__oak_cond,__Oak_String(``))?reduce(s,[],function _(acc=null,c=null){return __oak_push(acc,c)}):_splitNonEmpty(s,sep))(sep)},_extend=function _extend(pad=null,n=null){return ((part,sub,times)=>((times=int((n/len(pad)))),(part=(n%len(pad))),sub=function sub(base=null,i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(base=null,i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,0)?__oak_push(base,slice(pad,0,part)):__oak_trampoline(__oak_trampolined_sub,__oak_push(base,pad),(i-1)))(i)}),__oak_resolve_trampoline(__oak_trampolined_sub,base,i)))()},sub(__Oak_String(``),times)))()},padStart=function padStart(s=null,n=null,pad=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?s:__oak_push(_extend(pad,(n-len(s))),s))((len(s)>=n))},padEnd=function padEnd(s=null,n=null,pad=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?s:__as_oak_string(s+_extend(pad,(n-len(s)))))((len(s)>=n))},_trimStartSpace=function _trimStartSpace(s=null){return ((firstNonSpace,subStart)=>(subStart=function subStart(i=null){return ((__oak_trampolined_subStart)=>((__oak_trampolined_subStart=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_subStart,__as_oak_string(i+1)):i)(space__oak_qm(__oak_acc(s,__oak_obj_key((i)))))}),__oak_resolve_trampoline(__oak_trampolined_subStart,i)))()},(firstNonSpace=subStart(0)),slice(s,firstNonSpace)))()},_trimStartNonEmpty=function _trimStartNonEmpty(s=null,prefix=null){return ((idx,lpref,max,sub)=>((max=len(s)),(lpref=len(prefix)),sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_sub,__as_oak_string(i+lpref)):i)(_matchesAt__oak_qm(s,prefix,i)):i)((i<max))}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},(idx=sub(0)),slice(s,idx)))()},trimStart=function trimStart(s=null,prefix=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(``))?s:__oak_eq(__oak_cond,null)?_trimStartSpace(s):_trimStartNonEmpty(s,prefix))(prefix)},_trimEndSpace=function _trimEndSpace(s=null){return ((lastNonSpace,subEnd)=>(subEnd=function subEnd(i=null){return ((__oak_trampolined_subEnd)=>((__oak_trampolined_subEnd=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_subEnd,(i-1)):i)(space__oak_qm(__oak_acc(s,__oak_obj_key((i)))))}),__oak_resolve_trampoline(__oak_trampolined_subEnd,i)))()},(lastNonSpace=subEnd((len(s)-1))),slice(s,0,__as_oak_string(lastNonSpace+1))))()},_trimEndNonEmpty=function _trimEndNonEmpty(s=null,suffix=null){return ((idx,lsuf,sub)=>((lsuf=len(suffix)),sub=function sub(i=null){return ((__oak_trampolined_sub)=>((__oak_trampolined_sub=function _(i=null){return ((__oak_cond)=>__oak_eq(__oak_cond,true)?((__oak_cond)=>__oak_eq(__oak_cond,true)?__oak_trampoline(__oak_trampolined_sub,(i-lsuf)):i)(_matchesAt__oak_qm(s,suffix,(i-lsuf))):i)((i>-1))}),__oak_resolve_trampoline(__oak_trampolined_sub,i)))()},(idx=sub(len(s))),slice(s,0,idx)))()},trimEnd=function trimEnd(s=null,suffix=null){return ((__oak_cond)=>__oak_eq(__oak_cond,__Oak_String(``))?s:__oak_eq(__oak_cond,null)?_trimEndSpace(s):_trimEndNonEmpty(s,suffix))(suffix)},trim=function trim(s=null,part=null){return trimEnd(trimStart(s,part),part)},({_extend,_matchesAt__oak_qm,_replaceNonEmpty,_splitNonEmpty,_trimEndNonEmpty,_trimEndSpace,_trimStartNonEmpty,_trimStartSpace,checkRange,contains__oak_qm,cut,__oak_js_default,digit__oak_qm,endsWith__oak_qm,indexOf,join,letter__oak_qm,lower,lower__oak_qm,padEnd,padStart,reduce,replace,slice,space__oak_qm,split,startsWith__oak_qm,take,takeLast,trim,trimEnd,trimStart,upper,upper__oak_qm,word__oak_qm})))()}),(__Oak_Import_Aliases=({})),__oak_module_import(__Oak_String(``)))
</script>
